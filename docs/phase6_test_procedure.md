# Phase 6 動作確認テスト手順書

## 概要

本手順書はPhase 6（実験機能）の実装が正しく動作することを確認するためのテスト項目と手順を記載しています。

**対象**: フロントエンド（concern-app/）の実験管理UI

---

## 事前準備

### 環境確認

```bash
# 1. プロジェクトルートに移動
cd /home/nafell/source/sotuken

# 2. 依存関係のインストール確認
cd concern-app && bun install
cd ../server && bun install
cd ..

# 3. 環境変数の確認
# server/.env に GEMINI_API_KEY が設定されていることを確認
cat server/.env | grep GEMINI_API_KEY
```

### サーバー・フロントエンド起動

```bash
# 方法1: tmuxで一括起動
./tmux-fullstack.sh

# 方法2: 個別起動
# ターミナル1（バックエンド）
cd server && bun run dev

# ターミナル2（フロントエンド）
cd concern-app && bun run dev
```

### アクセスURL

| 環境 | フロントエンド | バックエンドAPI |
|------|---------------|-----------------|
| 開発 | http://localhost:5173 | http://localhost:8000 |
| 本番 | http://localhost:5173 | http://localhost:3000 |

| ページ | URL |
|--------|-----|
| 実験ダッシュボード | http://localhost:5173/research-experiment |

### 環境変数設定

**フロントエンド** (`concern-app/`):
- `.env.development`: `VITE_API_URL=http://localhost:8000`（開発用）
- `.env.production`: `VITE_API_URL=http://localhost:3000`（本番用）

**バックエンド** (`server/`):
- 開発環境: `PORT=8000` を設定
- 本番環境: デフォルト `PORT=3000`

> **重要**: フロントエンドを起動する前に、環境変数が正しく設定されていることを確認してください。変更後はフロントエンドの再起動が必要です。

---

## テスト項目一覧

| Part | カテゴリ | テスト項目数 | 優先度 |
|------|----------|-------------|--------|
| 1 | ルーティング確認 | 6 | 高 |
| 2 | ダッシュボード (ExperimentDashboard) | 5 | 高 |
| 3 | ケース選択 (CaseSelection) | 6 | 高 |
| 4 | ケース実行 (CaseExecution) | 7 | 高 |
| 5 | セッション一覧 (SessionList) | 5 | 中 |
| 6 | セッション詳細 (SessionDetail) | 6 | 中 |
| 7 | リプレイ (ReplayView) | 5 | 中 |
| 8 | API連携確認 | 4 | 高 |

**合計: 44項目**

---

## フロントエンドルート一覧

| パス | コンポーネント | 説明 |
|------|----------------|------|
| `/research-experiment` | ExperimentDashboard | メインダッシュボード |
| `/research-experiment/cases` | CaseSelection | テストケース選択 |
| `/research-experiment/execute/:caseId` | CaseExecution | ケース実行画面 |
| `/research-experiment/sessions` | SessionList | セッション一覧 |
| `/research-experiment/sessions/:sessionId` | SessionDetail | セッション詳細 |
| `/research-experiment/replay/:sessionId` | ReplayView | リプレイ表示 |

---

## Part 1: ルーティング確認

### 1.1 ダッシュボードルート

**URL**: http://localhost:5173/research-experiment

**確認項目**:
- [ ] ページが正常に表示される
- [ ] ローディング表示後にコンテンツが表示される

### 1.2 ケース選択ルート

**URL**: http://localhost:5173/research-experiment/cases

**確認項目**:
- [ ] ページが正常に表示される
- [ ] ダッシュボードからリンクで遷移できる

### 1.3 ケース実行ルート

**URL**: http://localhost:5173/research-experiment/execute/case_01

**確認項目**:
- [ ] ページが正常に表示される
- [ ] URLパラメータ（caseId）が正しく取得される

### 1.4 セッション一覧ルート

**URL**: http://localhost:5173/research-experiment/sessions

**確認項目**:
- [ ] ページが正常に表示される

### 1.5 セッション詳細ルート

**URL**: http://localhost:5173/research-experiment/sessions/{sessionId}

**確認項目**:
- [ ] 有効なsessionIdでページが表示される
- [ ] 無効なsessionIdで適切なエラー表示

### 1.6 リプレイルート

**URL**: http://localhost:5173/research-experiment/replay/{sessionId}

**確認項目**:
- [ ] ページが正常に表示される

---

## Part 2: ダッシュボード (ExperimentDashboard)

### 2.1 初期表示

**手順**: http://localhost:5173/research-experiment にアクセス

**確認項目**:
- [ ] ページタイトルが表示される
- [ ] ローディング中の表示が適切

### 2.2 設定情報表示

**確認項目**:
- [ ] Widget数条件（6, 9, 12）が表示される
- [ ] モデル条件（lite, standard, pro）が表示される
- [ ] デフォルト設定が表示される

### 2.3 ヘルスチェック表示

**確認項目**:
- [ ] API接続状態が表示される（OK/エラー）
- [ ] タイムスタンプが表示される

### 2.4 ナビゲーションリンク

**確認項目**:
- [ ] 「ケース選択」リンクが機能する
- [ ] 「セッション一覧」リンクが機能する

### 2.5 エラーハンドリング

**確認項目**:
- [ ] API接続エラー時に適切なメッセージが表示される

---

## Part 3: ケース選択 (CaseSelection)

### 3.1 ケース一覧表示

**手順**: http://localhost:5173/research-experiment/cases にアクセス

**確認項目**:
- [ ] 10件のテストケースが表示される
- [ ] 各ケースのタイトルが表示される

### 3.2 ケース詳細情報

**確認項目**:
- [ ] 複雑度（simple/medium/complex）が表示される
- [ ] Reactivity有無が表示される
- [ ] 悩みテキストのプレビューが表示される

### 3.3 フィルタリング機能

**確認項目**:
- [ ] 複雑度でフィルタリングできる
- [ ] Reactivity有無でフィルタリングできる

### 3.4 ケース選択操作

**確認項目**:
- [ ] ケースをクリックして選択できる
- [ ] 選択状態が視覚的にわかる

### 3.5 実行画面への遷移

**確認項目**:
- [ ] 「実行」ボタンで実行画面に遷移する
- [ ] 選択したcaseIdがURLに含まれる

### 3.6 戻るナビゲーション

**確認項目**:
- [ ] ダッシュボードに戻れる

---

## Part 4: ケース実行 (CaseExecution)

### 4.1 ケース情報表示

**手順**: http://localhost:5173/research-experiment/execute/case_01 にアクセス

**確認項目**:
- [ ] 選択したケースの詳細が表示される
- [ ] 悩みテキストが表示される
- [ ] コンテキスト要因が表示される

### 4.2 実験条件設定

**確認項目**:
- [ ] Widget数を選択できる（6, 9, 12）
- [ ] モデルを選択できる（lite, standard, pro）
- [ ] 実験タイプを選択できる（technical, expert, user）

### 4.3 実行開始

**確認項目**:
- [ ] 「実行開始」ボタンが機能する
- [ ] 実行中の進捗表示がある

### 4.4 UI生成結果表示

**確認項目**:
- [ ] 生成されたWidgetが表示される
- [ ] エラー時にエラーメッセージが表示される

### 4.5 メトリクス表示

**確認項目**:
- [ ] トークン数が表示される
- [ ] レイテンシ（処理時間）が表示される

### 4.6 セッション保存

**確認項目**:
- [ ] 実行完了後にセッションが保存される
- [ ] セッションIDが表示される

### 4.7 後続操作

**確認項目**:
- [ ] セッション詳細へのリンクがある
- [ ] 別のケースを実行するリンクがある

---

## Part 5: セッション一覧 (SessionList)

### 5.1 一覧表示

**手順**: http://localhost:5173/research-experiment/sessions にアクセス

**確認項目**:
- [ ] セッション一覧が表示される
- [ ] 新しい順にソートされている

### 5.2 セッション情報表示

**確認項目**:
- [ ] セッションID（短縮形）が表示される
- [ ] ケースID/タイトルが表示される
- [ ] 実験タイプが表示される
- [ ] 作成日時が表示される

### 5.3 フィルタリング

**確認項目**:
- [ ] 実験タイプでフィルタリングできる
- [ ] ケースIDでフィルタリングできる

### 5.4 ページネーション

**確認項目**:
- [ ] 大量データ時にページネーションが機能する

### 5.5 詳細画面への遷移

**確認項目**:
- [ ] セッションをクリックして詳細画面に遷移できる

---

## Part 6: セッション詳細 (SessionDetail)

### 6.1 基本情報表示

**手順**: http://localhost:5173/research-experiment/sessions/{sessionId} にアクセス

**確認項目**:
- [ ] セッションIDが表示される
- [ ] 実験タイプが表示される
- [ ] ケース情報が表示される

### 6.2 入力データ表示

**確認項目**:
- [ ] 悩みテキストが表示される
- [ ] コンテキスト要因が表示される

### 6.3 生成結果表示

**確認項目**:
- [ ] OODM（構造化データ）が表示される
- [ ] DSL（UI仕様）が表示される
- [ ] JSONが整形表示される

### 6.4 メトリクス表示

**確認項目**:
- [ ] 総トークン数が表示される
- [ ] OODM生成メトリクスが表示される
- [ ] DSL生成メトリクスが表示される
- [ ] 総レイテンシが表示される

### 6.5 エラー情報表示

**確認項目**:
- [ ] 生成失敗時にエラーメッセージが表示される

### 6.6 リプレイへの遷移

**確認項目**:
- [ ] 「リプレイ」ボタンでリプレイ画面に遷移できる

---

## Part 7: リプレイ (ReplayView)

### 7.1 初期表示

**手順**: http://localhost:5173/research-experiment/replay/{sessionId} にアクセス

**確認項目**:
- [ ] セッション情報が読み込まれる
- [ ] Widget状態が読み込まれる

### 7.2 Widget状態表示

**確認項目**:
- [ ] 保存されたWidget設定が表示される
- [ ] ユーザー入力データが表示される
- [ ] Port値が表示される

### 7.3 ステップナビゲーション

**確認項目**:
- [ ] 現在のステップ番号が表示される
- [ ] 「次へ」ボタンで次のステップに進める
- [ ] 「前へ」ボタンで前のステップに戻れる

### 7.4 読み取り専用モード

**確認項目**:
- [ ] 入力フィールドが編集不可である
- [ ] ボタン操作が無効化されている

### 7.5 メタ情報パネル

**確認項目**:
- [ ] セッションメタデータが表示される
- [ ] デバッグ情報が表示される（オプション）

---

## Part 8: API連携確認

### 8.1 設定API

**確認項目**:
- [ ] `/api/experiment/settings` からデータ取得できる
- [ ] `/api/experiment/health` でヘルスチェックできる

### 8.2 ケースAPI

**確認項目**:
- [ ] `/api/experiment/cases` でケース一覧取得できる
- [ ] `/api/experiment/cases/:caseId` で個別ケース取得できる

### 8.3 セッションAPI

**確認項目**:
- [ ] セッション作成（POST）が機能する
- [ ] セッション一覧取得（GET）が機能する
- [ ] セッション詳細取得（GET）が機能する
- [ ] セッション更新（PATCH）が機能する

### 8.4 Widget状態API

**確認項目**:
- [ ] Widget状態保存（POST）が機能する
- [ ] Widget状態取得（GET）が機能する

---

## E2Eテストシナリオ

### シナリオ1: 基本フロー

1. ダッシュボードにアクセス
2. 「ケース選択」をクリック
3. case_01を選択
4. 「実行」をクリック
5. 実験条件を設定（Widget数: 12, モデル: lite）
6. 「実行開始」をクリック
7. UI生成完了を待つ
8. セッション詳細を確認
9. リプレイで状態を確認

**期待結果**:
- [ ] すべての画面遷移がスムーズ
- [ ] データが正しく保存される
- [ ] リプレイで状態が再現される

### シナリオ2: エラーケース

1. 無効なsessionIdでセッション詳細にアクセス
2. APIサーバー停止状態でダッシュボードにアクセス

**期待結果**:
- [ ] 適切なエラーメッセージが表示される
- [ ] アプリがクラッシュしない

---

## テスト結果記録

| 日付 | テスター | Part 1 | Part 2 | Part 3 | Part 4 | Part 5 | Part 6 | Part 7 | Part 8 | 備考 |
|------|----------|--------|--------|--------|--------|--------|--------|--------|--------|------|
| | | /6 | /5 | /6 | /7 | /5 | /6 | /5 | /4 | |

---

## トラブルシューティング

### よくある問題

1. **フロントエンドが起動しない**
   ```bash
   cd concern-app && bun install && bun run dev
   ```

2. **APIエラー（CORS）**
   - サーバーが起動しているか確認
   - ポート3001でリッスンしているか確認

3. **ページが表示されない（404）**
   - URLが正しいか確認
   - React Routerの設定を確認

4. **データが表示されない**
   - ブラウザの開発者ツールでネットワークエラーを確認
   - APIレスポンスを確認

---

## 参考資料

- [Phase 6詳細タスク計画](../specs/project/phase6/phase6_detailed_tasks.md)
- [実験要件定義書](../specs/project/phase6/experiment-requirements.md)
- [App.tsx ルーティング設定](../concern-app/src/App.tsx)

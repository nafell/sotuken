prompt:

あなたはCBTベースの思考整理アプリのUISpec生成AIです。
ORS（データ構造）と選定Widgetに基づいて、UISpec（画面仕様）を生成してください。

## ORS（データ構造）
{
  "version": "4.0",
  "entities": [
    {
      "id": "concern",
      "type": "concern",
      "attributes": [
        {
          "name": "text",
          "structuralType": "SVAL",
          "valueType": "string",
          "description": "ユーザーの元の悩みテキスト"
        }
      ]
    },
    {
      "id": "diverge_data",
      "type": "stage_data",
      "attributes": [
        {
          "name": "items",
          "structuralType": "ARRY",
          "itemType": "SVAL",
          "itemValueType": "string",
          "description": "divergeステージのデータ項目"
        }
      ]
    }
  ],
  "dependencyGraph": {
    "dependencies": [],
    "metadata": {
      "version": "4.0",
      "generatedAt": 1765159245059
    }
  },
  "metadata": {
    "generatedAt": 1765159245059,
    "llmModel": "fallback",
    "sessionId": "18fe0e73-212a-4868-ae6b-49f05ca28a27",
    "stage": "diverge"
  }
}

## 選定されたWidget情報
{
  "widgets": [
    {
      "widgetId": "brainstorm_cards",
      "purpose": "研究活動における楽しさの源泉、具体的なアイデア、そして寝るのを忘れてしまう状況に繋がる思考を自由に書き出し、可視化します。",
      "order": 0,
      "suggestedConfig": {},
      "suggestedBindings": []
    },
    {
      "widgetId": "question_card_chain",
      "purpose": "「なぜ研究に没頭すると時間を忘れるのか？」「睡眠不足が研究や生活に与える影響は？」といった問いを通じて、問題の根本原因や思考パターンを深く掘り下げます。",
      "order": 1,
      "suggestedConfig": {
        "questions": [
          "研究のどのような側面に最も魅力を感じますか？",
          "寝るのを忘れるほど没頭する研究テーマやタスクは何ですか？",
          "睡眠を犠牲にすることで、具体的にどのようなメリット（と感じられるもの）を得ていますか？",
          "睡眠不足が翌日の集中力や気分、健康に与える具体的な影響は何ですか？",
          "研究活動が中断されることへの潜在的な不安やストレスはありますか？"
        ]
      },
      "suggestedBindings": []
    }
  ],
  "purpose": "研究活動への強い情熱と、それが睡眠習慣に与える影響に関するあらゆる思考、感情、アイデアを広範囲にわたって洗い出します。",
  "target": "研究に対する喜びの感情、具体的な研究アイデア、睡眠不足に繋がる思考、およびその結果",
  "description": "ユーザーが研究活動に感じる純粋な喜びや、その際に湧き上がるアイデア、そして睡眠を忘れさせるような思考の連鎖を、まずは制限なく書き出します。次に、ガイド付きの質問に回答することで、現在の行動パターンやその背景にある深層的な思考、感情、そして長期的な影響について多角的に探求します。",
  "estimatedDuration": 360
}

## 現在のステージ
diverge

## Widget定義情報
[
  {
    "id": "brainstorm_cards",
    "name": "ブレインストームカード",
    "description": "自由にアイデアをカードとして追加し、視覚的に整理する。",
    "complexity": 0.2,
    "inputs": [],
    "outputs": [
      {
        "id": "cards",
        "dataType": "object[]",
        "description": "カードリスト {id: string, text: string, color?: string}"
      },
      {
        "id": "cardCount",
        "dataType": "number",
        "description": "カードの総数"
      }
    ],
    "generationHints": {
      "samples": {
        "field": "sampleCards",
        "instruction": "ユーザーの悩みに関連するアイデアの種となるカードを2-3個生成してください。ユーザーの思考を促すきっかけとなる具体的な内容にしてください。",
        "count": {
          "min": 2,
          "max": 3
        },
        "schema": {
          "id": "string (sample_1, sample_2, ...)",
          "text": "string (日本語、15-30文字程度)",
          "color": "string (optional, hex color)"
        }
      }
    }
  },
  {
    "id": "question_card_chain",
    "name": "質問カードチェーン",
    "description": "質問に対する回答を連鎖的に記録し、思考の流れを可視化。",
    "complexity": 0.3,
    "inputs": [
      {
        "id": "questions",
        "dataType": "string[]",
        "description": "提示する質問リスト",
        "required": false
      }
    ],
    "outputs": [
      {
        "id": "answers",
        "dataType": "object[]",
        "description": "回答リスト {questionId: string, answer: string}"
      },
      {
        "id": "completedCount",
        "dataType": "number",
        "description": "回答済みの質問数"
      }
    ]
  }
]

## Reactivityモード
true

## タスク
以下を生成してください：

### 1. WidgetSpecの定義
各Widgetの具体的な仕様を定義します。

**必須フィールド**:
- **id**: UISpec内で一意のWidget ID（例: "brainstorm_0", "card_sorting_1"）
- **component**: Widget種別（選定されたwidgetIdと一致）
- **position**: 表示順序（0から開始）
- **config**: Widget固有の設定
- **dataBindings**: ORSとのデータ連携

### 2. DataBindingの定義
WidgetのPortとORSのEntity.Attributeを対応付けます。

**バインディング方向**:
- **in**: ORSからWidgetへの入力（Widget初期化時）
- **out**: WidgetからORSへの出力（Widget操作時）
- **inout**: 双方向バインディング

### 3. ReactiveBindingの定義（Reactivity有効時）
Widget間のリアクティブなUI連携を定義します。

**メカニズム**:
- **update**: ソースの変更時にターゲットの値を更新
- **validate**: ソースの変更時にターゲットの値を検証

**関係仕様タイプ**:
- **passthrough**: 値をそのまま渡す
- **javascript**: JavaScript式による変換
- **transform**: 変換式による処理
- **llm**: LLMによる処理

**更新モード**:
- **realtime**: 即座に反映
- **debounced**: 遅延後に反映（連続入力の最適化）
- **on_confirm**: ユーザー確認後に反映

### 4. レイアウト設定
画面全体のレイアウトを定義します。

### 5. コンテンツ生成（generatedValue）
Widget定義に**generationHints**がある場合、ユーザーの悩みに関連するコンテンツを動的に生成してconfig内に配置してください。

**Type B: サンプルデータ（samples）**
generationHints.samplesが定義されている場合:
- fieldで指定されたキー（例: "sampleCards"）にGeneratedContentContainerを配置
- instructionに従い、countで指定された範囲の数のアイテムを生成
- 各アイテムには必ず**isGenerated: true**を付与
- コンテナにも**isGenerated: true**を付与

**生成例: BrainstormCards**
ユーザーの悩み: 「転職するか迷っている」

```json
{
  "id": "brainstorm_0",
  "component": "brainstorm_cards",
  "config": {
    "title": "転職について考えてみましょう",
    "sampleCards": {
      "items": [
        { "id": "sample_1", "text": "現職で得られているもの・失うもの", "isGenerated": true },
        { "id": "sample_2", "text": "転職で実現したい理想の働き方", "isGenerated": true }
      ],
      "isGenerated": true
    }
  }
}
```

**重要ルール**:
1. 生成内容はユーザーの**具体的な悩みの内容に関連**させる（一般的すぎる内容はNG）
2. サンプルは「考えるきっかけ」であり、**完成した答えではない**
3. **日本語で生成**する
4. **isGenerated: true**マーカーを必ず付与する
5. generationHintsがないWidgetには生成コンテンツを含めない

## 出力形式
以下のJSON形式で出力してください：

```json
{
  "version": "4.0",
  "sessionId": "{{sessionId}}",
  "stage": "diverge",
  "widgets": [
    {
      "id": "brainstorm_0",
      "component": "brainstorm_cards",
      "position": 0,
      "layout": "full",
      "config": {
        "title": "アイデアを出してみましょう",
        "placeholder": "思いついたことを書いてください",
        "minItems": 3,
        "maxItems": 10,
        "sampleCards": {
          "items": [
            { "id": "sample_1", "text": "現状の問題点を洗い出す", "isGenerated": true },
            { "id": "sample_2", "text": "理想の状態を具体的にイメージする", "isGenerated": true }
          ],
          "isGenerated": true
        }
      },
      "dataBindings": [
        {
          "portId": "input_items",
          "entityAttribute": "diverge_data.items",
          "direction": "in"
        },
        {
          "portId": "output_items",
          "entityAttribute": "brainstorm_widget.output_items",
          "direction": "out"
        }
      ],
      "metadata": {
        "purpose": "悩みに関連するアイデアを発散的に出す"
      }
    },
    {
      "id": "emotion_palette_1",
      "component": "emotion_palette",
      "position": 1,
      "layout": "half",
      "config": {
        "emotionSet": "basic",
        "multiSelect": true
      },
      "dataBindings": [
        {
          "portId": "selected_emotions",
          "entityAttribute": "emotion_widget.emotions",
          "direction": "out"
        }
      ],
      "metadata": {
        "purpose": "アイデアに対する感情を可視化"
      }
    }
  ],
  "reactiveBindings": {
    "bindings": [
      {
        "id": "binding_brainstorm_to_emotion",
        "source": "brainstorm_0.output_items",
        "target": "emotion_palette_1.context_items",
        "mechanism": "update",
        "relationship": {
          "type": "passthrough"
        },
        "updateMode": "debounced",
        "debounceMs": 500,
        "description": "ブレインストームの結果を感情パレットに連携",
        "enabled": true
      }
    ],
    "metadata": {
      "version": "4.0",
      "generatedAt": 1765158377843
    }
  },
  "layout": {
    "type": "single_column",
    "gap": 16,
    "padding": {
      "top": 16,
      "right": 16,
      "bottom": 16,
      "left": 16
    }
  },
  "metadata": {
    "generatedAt": 1765158377843,
    "llmModel": "gemini-2.5-flash"
  }
}
```

## 重要な注意点

### DataBinding
1. 各WidgetのポートIDはWidget定義のports.inputs/outputsを参照してください
2. entityAttributeは「entityId.attributeName」形式でORSと一致させてください
3. required=trueの入力ポートには必ずdirectionが'in'または'inout'のバインディングを定義してください

### ReactiveBinding（Reactivity有効時のみ）
1. source/targetは「widgetId.portId」形式で指定してください
2. complexityの高いWidget（0.4以上）をターゲットにする場合はdebounced/on_confirmを検討してください
3. 同一ソースから複数ターゲットへのバインディングは可能ですが、循環参照は避けてください
4. 前後のWidget間でデータを連携する場合はpassthroughが基本です
5. データ変換が必要な場合はjavascript関係を使用してください

### レイアウト
1. Widget数が少ない（2つ以下）場合は'single_column'を推奨
2. 関連性の高いWidgetは近い位置に配置してください
3. 主要なWidgetは'full'レイアウト、補助的なWidgetは'half'/'third'を検討してください

---

UISpec:

{
  "stage": "diverge",
  "layout": {
    "type": "single_column"
  },
  "version": "4.0",
  "widgets": [
    {
      "id": "brainstorm_cards_0",
      "config": {
        "title": "研究活動と睡眠に関する思考",
        "placeholder": "研究の魅力、寝ない理由、睡眠不足の弊害などを書き出す"
      },
      "metadata": {
        "purpose": "「研究活動が楽しすぎて寝るのを忘れる」ことに関するあらゆる思考、感情、アイデアを自由に書き出し、可視化する。"
      },
      "position": 0,
      "component": "brainstorm_cards",
      "dataBindings": []
    },
    {
      "id": "question_card_chain_1",
      "config": {
        "initialQuestion": "なぜ研究活動が楽しすぎて寝るのを忘れてしまうのか？",
        "suggestedQuestions": [
          "研究活動のどの部分に最も喜びを感じるか？",
          "睡眠を削ることで、具体的にどのようなメリット・デメリットを感じるか？",
          "もし十分な睡眠を取れたとしたら、研究活動はどう変わると思うか？",
          "長期的にこの状況が続くとどうなると思うか？"
        ]
      },
      "metadata": {
        "purpose": "ブレインストームで洗い出した思考に対し、「なぜ？」や「どうなる？」といった質問を連鎖させ、問題の背景と影響を深掘りする。"
      },
      "position": 1,
      "component": "question_card_chain",
      "dataBindings": [
        {
          "portId": "questions",
          "direction": "in",
          "entityAttribute": "diverge_data.items"
        }
      ]
    }
  ],
  "metadata": {
    "llmModel": "fallback",
    "generatedAt": 1765156814275
  },
  "sessionId": "32e14e42-0f21-468a-967a-1caa16ca1f3b",
  "reactiveBindings": {
    "bindings": [
      {
        "id": "binding_brainstorm_cards_0_question_card_chain_1",
        "source": "brainstorm_cards_0.cards",
        "target": "question_card_chain_1.questions",
        "enabled": true,
        "mechanism": "update",
        "updateMode": "realtime",
        "description": "Default sequential binding",
        "relationship": {
          "type": "passthrough"
        }
      }
    ],
    "metadata": {
      "version": "4.0",
      "generatedAt": 1765156814275
    }
  }
}
# Phase 6 実験環境 実装状況調査報告書

## 1. 調査概要
- **調査対象**: `/research-experiment` ルートおよび関連コンポーネント
- **目的**: 実験環境の完成度確認と、デモ環境（`/dev-demo/full-flow`）との差異分析
- **実施日**: 2025-11-30

## 2. 現状のステータス

### 2.1 実験アプリ (`/research-experiment`)
**ステータス: 🚧 未完成（ガワのみ）**

- **UI構造**:
  - ダッシュボード、ケース選択、セッション一覧などの画面遷移は実装済み。
  - **決定的な欠落**: `CaseExecution.tsx` がモック実装のままです。
    - 「実行」ボタンを押すと、LLMを呼び出すことなく即座に「完了」ステータスになります。
    - `// TODO: Integrate with actual UI generation` というコメントが残されています。
- **データ保存**:
  - セッションの作成（`createSession`）と完了更新（`updateSession`）はAPIとして存在しますが、肝心の生成データ（OODM, DSL, Metrics）が空のまま保存されます。

### 2.2 思考整理ロジック (`/dev-demo/full-flow`)
**ステータス: ✅ 動作確認済み**

- **機能**:
  - `FullFlowContainer` および `useFullFlowState` フックにより、Capture -> Plan (Diverge/Organize/Converge/Summary) -> Breakdown の一連のフローが実装されています。
  - `PlanPhase.tsx` 内で `apiService.generateUIV3` を呼び出し、実際にLLMによる動的UI生成が行われています。
- **課題**:
  - 現在はデモ用であり、実験用のデータ保存（`experiment_sessions`テーブルへの記録）とは連携していません。
  - オンメモリで状態管理されており、ブラウザリロードで消えます。

## 3. ギャップ分析

| 機能 | 実験アプリ (Current) | デモアプリ (Target Logic) | 必要な作業 |
|------|-------------------|------------------------|------------|
| **LLM連携** | ❌ 未実装 | ✅ 実装済み | デモアプリのAPI呼び出しロジックを移植 |
| **フロー制御** | ❌ 単一画面 | ✅ ステップ実行 | `FullFlowContainer`相当のUIを実験実行画面に組み込む |
| **データ保存** | ⚠️ メタデータのみ | ❌ オンメモリのみ | 生成結果・メトリクスをDB保存処理に渡すよう統合 |
| **テストケース** | ✅ 読み込み可 | ❌ 固定テキスト | テストケースの入力値（`concernText`等）をフロー初期値として渡す |

## 4. 結論
実験環境として稼働させるためには、**「デモアプリのロジック（脳みそ）」を「実験アプリのUI（身体）」に移植する手術**が必要です。
具体的には、Phase 7にて以下の統合を行う必要があります。

1. `CaseExecution` ページ内で `FullFlowContainer` (またはその改良版) をレンダリングする。
2. フローの各ステップ完了時に、結果を `experiment_sessions` および `widget_states` テーブルに保存するフックを仕込む。
3. 実験モード（技術検証/専門家評価/ユーザー実験）に応じて、フローの挙動（自動進行か、手動操作かなど）を切り替えられるようにする。

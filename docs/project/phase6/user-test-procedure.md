# ユーザテスト実施手順書

**プロジェクト**: 頭の棚卸しノート（Mental Inventory Note）
**Phase 6**: 実験・評価環境構築
**作成日**: 2024年11月

---

## 目次

1. [概要](#1-概要)
2. [事前準備](#2-事前準備)
3. [テスト環境セットアップ](#3-テスト環境セットアップ)
4. [テスト実施手順](#4-テスト実施手順)
5. [データ収集](#5-データ収集)
6. [トラブルシューティング](#6-トラブルシューティング)
7. [付録](#7-付録)

---

## 1. 概要

### 1.1 テスト目的

本ユーザテストは、LLM生成動的UIの有効性を評価するために実施します。

| 評価項目 | 内容 |
|---------|------|
| ユーザビリティ | UIの使いやすさ、直感性 |
| 有効性 | 悩み整理への貢献度 |
| Reactivity効果 | Widget間連携の体験価値 |
| 認知負荷 | 操作の複雑さ、理解しやすさ |

### 1.2 参加者

- **人数**: 5名
- **条件**: 日本語ネイティブ、スマートフォン操作に慣れている
- **除外条件**: 開発チームメンバー、CBTの専門家

### 1.3 所要時間

| フェーズ | 時間 |
|---------|------|
| 説明・同意取得 | 5分 |
| 実験タスク | 15-20分 |
| 事後アンケート | 10分 |
| インタビュー（任意） | 5-10分 |
| **合計** | **35-45分** |

---

## 2. 事前準備

### 2.1 必要機材

- [ ] テスト用PC/Mac（開発サーバー起動用）
- [ ] 参加者用デバイス（スマートフォン推奨、PCも可）
- [ ] 安定したWi-Fi環境
- [ ] 画面録画ツール（任意）
- [ ] 同意書・アンケート用紙

### 2.2 事前確認事項

```bash
# 1. リポジトリの最新化
cd /home/tk220307/sotuken
git checkout main
git pull origin main

# 2. 依存関係インストール
cd server && bun install
cd ../concern-app && bun install

# 3. 環境変数確認
cat server/.env
# GEMINI_API_KEY が設定されていること

# 4. データベースマイグレーション
cd server && bun run db:migrate
```

### 2.3 同意書の準備

以下の内容を含む同意書を準備：

1. 研究目的と概要
2. 参加の任意性
3. データの匿名化処理
4. 途中離脱の権利
5. データ利用範囲
6. 連絡先

---

## 3. テスト環境セットアップ

### 3.1 サーバー起動

```bash
# ターミナル1: バックエンド起動
cd /home/tk220307/sotuken/server
bun run dev

# 起動確認（別ターミナルで）
curl http://localhost:8000/api/experiment/health
```

期待レスポンス:
```json
{
  "status": "healthy",
  "timestamp": "2024-11-XX...",
  "config": {
    "settingsVersion": "1.0.0",
    "testCaseCount": 10,
    "widgetConditions": 3,
    "modelConditions": 3
  }
}
```

```bash
# ターミナル2: フロントエンド起動
cd /home/tk220307/sotuken/concern-app
bun run dev

# ブラウザで確認
# http://localhost:5173
```

### 3.2 実験設定の確認

```bash
# テストケース一覧確認
curl http://localhost:8000/api/experiment/cases | jq '.cases[] | {caseId, title, hasReactivity}'
```

### 3.3 参加者アクセス設定

**ローカルネットワーク接続の場合**:
```bash
# サーバーのIPアドレス確認
ip addr show | grep "inet "

# 参加者に伝えるURL
# http://[サーバーIP]:5173
```

**ngrokを使用する場合**（外部アクセス）:
```bash
ngrok http 5173
# 生成されたURLを参加者に共有
```

---

## 4. テスト実施手順

### 4.1 参加者受付（5分）

1. 挨拶と自己紹介
2. 研究目的の説明
3. 同意書の説明と署名取得
4. 質問への回答

### 4.2 操作説明（3分）

参加者に以下を説明：

> 「これから、あなたの悩みや心配事を整理するアプリを使っていただきます。
> アプリは質問に答えながら進めていくと、自動的にあなたに合った整理方法を提示します。
> 正解・不正解はありませんので、思ったとおりに操作してください。
> 操作中に困ったことがあれば、いつでもお声がけください。」

### 4.3 実験タスク実施（15-20分）

#### ステップ1: アプリアクセス

参加者にURLを共有し、アクセスしてもらう:
```
http://localhost:5173
```

#### ステップ2: 悩み入力

参加者に以下のいずれかを選択してもらう：

**A) 自分の悩みを入力**
- 「最近気になっていることや、整理したい悩みを入力してください」

**B) サンプル悩みを使用**（自分の悩みがない場合）

| ID | 悩み内容（短縮版） |
|----|------------------|
| 1 | 転職先が多すぎて決められない |
| 2 | 新規事業を提案したいが失敗が怖い |
| 3 | 引っ越し先の条件が複雑すぎる |
| 4 | 資格試験の勉強法で迷っている |
| 5 | 副業を始めたいが何から始めるか分からない |

#### ステップ3: コンテキスト質問

アプリの質問に回答してもらう：
- カテゴリ選択
- 緊急度
- 現在の気持ち
- 使える時間

#### ステップ4: 動的UI操作

生成されたWidgetを順番に操作：
1. 各Widgetの指示を読む
2. 入力・選択を行う
3. 次へ進む

**観察ポイント**:
- [ ] 迷っている箇所
- [ ] 質問した内容
- [ ] 表情・反応
- [ ] 操作時間

#### ステップ5: 完了

最後のサマリー画面まで到達したら完了。

### 4.4 事後アンケート（10分）

以下の質問に5段階評価で回答してもらう：

**ユーザビリティ**
1. アプリの操作は分かりやすかったですか？
2. 次に何をすべきか分かりましたか？
3. 画面のレイアウトは見やすかったですか？

**有効性**
4. 悩みが整理できた実感がありますか？
5. 新しい視点や気づきが得られましたか？
6. 次のアクションが明確になりましたか？

**満足度**
7. このアプリをまた使いたいと思いますか？
8. 他の人にも勧めたいと思いますか？

**自由記述**
9. 良かった点は何ですか？
10. 改善してほしい点は何ですか？

### 4.5 インタビュー（任意、5-10分）

以下について深掘り：

- 「一番印象に残った画面はどれですか？」
- 「分かりにくかった部分はありましたか？」
- 「Widget同士が連携していることに気づきましたか？」
- 「普段の悩み整理方法と比べてどうでしたか？」

---

## 5. データ収集

### 5.1 セッションデータ確認

テスト終了後、管理画面でセッションデータを確認：

```
http://localhost:5173/research-experiment/sessions
```

各セッションで以下を記録：
- セッションID
- 使用Widget数
- 総トークン数
- 総レイテンシ
- 完了ステータス

### 5.2 Widget状態のエクスポート

```bash
# セッション一覧取得
curl http://localhost:8000/api/experiment/sessions | jq '.sessions[] | {sessionId, caseId, completedAt}'

# 特定セッションのWidget状態取得
curl http://localhost:8000/api/experiment/sessions/[SESSION_ID]/widget-states | jq '.'
```

### 5.3 リプレイ確認

記録されたセッションをリプレイで確認：
```
http://localhost:5173/research-experiment/replay/[SESSION_ID]
```

### 5.4 データ保存

```bash
# データベースバックアップ
pg_dump -h localhost -U postgres sotuken > backup_$(date +%Y%m%d_%H%M%S).sql

# または、JSONエクスポート
mkdir -p exports/$(date +%Y%m%d)
curl http://localhost:8000/api/experiment/sessions > exports/$(date +%Y%m%d)/sessions.json
```

---

## 6. トラブルシューティング

### 6.1 サーバーが起動しない

```bash
# ポート使用確認
lsof -i :8000
lsof -i :5173

# プロセス終了
kill -9 [PID]

# 再起動
bun run dev
```

### 6.2 API呼び出しエラー

```bash
# GEMINI_API_KEY確認
echo $GEMINI_API_KEY

# 設定ファイル確認
cat server/.env
```

### 6.3 データベースエラー

```bash
# マイグレーション再実行
cd server
bun run db:push

# スキーマ確認
bun run db:studio
```

### 6.4 フロントエンドビルドエラー

```bash
# キャッシュクリア
cd concern-app
rm -rf node_modules/.vite
bun run dev
```

### 6.5 参加者のデバイスで表示されない

1. 同一ネットワークに接続されているか確認
2. ファイアウォール設定確認
3. URLの再確認（IPアドレス、ポート番号）

---

## 7. 付録

### 7.1 テストケース一覧

| ID | タイトル | 複雑度 | Reactivity |
|----|---------|--------|------------|
| case_01 | 選択肢が多すぎる | simple | なし |
| case_02 | 感情的ブロック | medium | あり |
| case_03 | 複数要因の絡み合い | complex | あり |
| case_04 | 情報不足での決断 | medium | なし |
| case_05 | 優先順位がつけられない | medium | あり |
| case_06 | 固定観念による停滞 | medium | なし |
| case_07 | 時間軸の見通し不足 | medium | あり |
| case_08 | 深掘り不足 | simple | なし |
| case_09 | 複合ボトルネック | complex | あり |
| case_10 | 総合ケース | complex | あり |

### 7.2 評価指標

| 指標 | 測定方法 |
|------|---------|
| タスク完了率 | 完了セッション数 / 開始セッション数 |
| 平均操作時間 | completedAt - startedAt |
| SUS スコア | System Usability Scale (0-100) |
| NPS | Net Promoter Score (-100 to +100) |
| 認知負荷 | NASA-TLX または 主観評価 |

### 7.3 管理画面URL一覧

| 画面 | URL |
|------|-----|
| ダッシュボード | `/research-experiment` |
| テストケース選択 | `/research-experiment/cases` |
| 実験実行 | `/research-experiment/execute/:caseId` |
| セッション一覧 | `/research-experiment/sessions` |
| セッション詳細 | `/research-experiment/sessions/:sessionId` |
| リプレイ | `/research-experiment/replay/:sessionId` |

### 7.4 緊急連絡先

- 技術担当: [担当者名] ([連絡先])
- 研究責任者: [担当者名] ([連絡先])

---

## 更新履歴

| 日付 | 版 | 変更内容 |
|------|-----|---------|
| 2024-11-29 | 1.0 | 初版作成 |

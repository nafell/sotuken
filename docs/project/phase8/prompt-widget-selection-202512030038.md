{
  "widgetSelection": {
    "prompt": "\nあなたはCBTベースの思考整理アプリのWidget選定AIです。\nユーザーの悩みとボトルネック種別に基づいて、4ステージ分のWidgetを選定してください。\n\n## ユーザーの悩み\n研究活動が楽しすぎて睡眠が疎かになってしまう\n\n## 診断されたボトルネック種別\nthought\n\n## 利用可能なWidget\n[\n  {\n    \"id\": \"emotion_palette\",\n    \"name\": \"感情パレット\",\n    \"description\": \"感情をカラーパレットから選択し、強度を調整する。\",\n    \"stage\": \"diverge\",\n    \"metadata\": {\n      \"timing\": 0.15,\n      \"versatility\": 0.6,\n      \"complexity\": 0.3,\n      \"bottleneck\": [\n        \"emotion\",\n        \"feeling\",\n        \"mood\"\n      ]\n    },\n    \"ports\": {\n      \"inputs\": [],\n      \"outputs\": [\n        {\n          \"id\": \"selectedEmotions\",\n          \"dataType\": \"object[]\",\n          \"description\": \"選択された感情リスト {emotion: string, intensity: number}\"\n        },\n        {\n          \"id\": \"dominantEmotion\",\n          \"dataType\": \"string\",\n          \"description\": \"最も強い感情\"\n        }\n      ]\n    }\n  },\n  {\n    \"id\": \"brainstorm_cards\",\n    \"name\": \"ブレインストームカード\",\n    \"description\": \"自由にアイデアをカードとして追加し、視覚的に整理する。\",\n    \"stage\": \"diverge\",\n    \"metadata\": {\n      \"timing\": 0.1,\n      \"versatility\": 0.95,\n      \"complexity\": 0.2,\n      \"bottleneck\": [\n        \"ideation\",\n        \"brainstorm\",\n        \"collection\"\n      ]\n    },\n    \"ports\": {\n      \"inputs\": [],\n      \"outputs\": [\n        {\n          \"id\": \"cards\",\n          \"dataType\": \"object[]\",\n          \"description\": \"カードリスト {id: string, text: string, color?: string}\"\n        },\n        {\n          \"id\": \"cardCount\",\n          \"dataType\": \"number\",\n          \"description\": \"カードの総数\"\n        }\n      ]\n    }\n  },\n  {\n    \"id\": \"concern_map\",\n    \"name\": \"関心事マップ\",\n    \"description\": \"中心トピックから放射状にアイデアを展開するマインドマップ。\",\n    \"stage\": \"diverge\",\n    \"metadata\": {\n      \"timing\": 0.2,\n      \"versatility\": 0.9,\n      \"complexity\": 0.5,\n      \"bottleneck\": [\n        \"ideation\",\n        \"association\",\n        \"exploration\"\n      ]\n    },\n    \"ports\": {\n      \"inputs\": [\n        {\n          \"id\": \"centralTopic\",\n          \"dataType\": \"string\",\n          \"description\": \"中心トピック\",\n          \"required\": false\n        }\n      ],\n      \"outputs\": [\n        {\n          \"id\": \"nodes\",\n          \"dataType\": \"object[]\",\n          \"description\": \"マインドマップのノード\"\n        },\n        {\n          \"id\": \"connections\",\n          \"dataType\": \"object[]\",\n          \"description\": \"ノード間の接続\"\n        },\n        {\n          \"id\": \"depth\",\n          \"dataType\": \"number\",\n          \"description\": \"最大の深さ\"\n        }\n      ]\n    }\n  },\n  {\n    \"id\": \"free_writing\",\n    \"name\": \"フリーライティング\",\n    \"description\": \"自由に思考を書き出すテキストエリア。タイマー付きで集中を促進。\",\n    \"stage\": \"diverge\",\n    \"metadata\": {\n      \"timing\": 0.05,\n      \"versatility\": 0.85,\n      \"complexity\": 0.1,\n      \"bottleneck\": [\n        \"expression\",\n        \"exploration\",\n        \"venting\"\n      ]\n    },\n    \"ports\": {\n      \"inputs\": [\n        {\n          \"id\": \"prompt\",\n          \"dataType\": \"string\",\n          \"description\": \"書き出しのためのプロンプト\",\n          \"required\": false\n        }\n      ],\n      \"outputs\": [\n        {\n          \"id\": \"text\",\n          \"dataType\": \"string\",\n          \"description\": \"書き出されたテキスト\"\n        },\n        {\n          \"id\": \"wordCount\",\n          \"dataType\": \"number\",\n          \"description\": \"単語数\"\n        }\n      ]\n    }\n  },\n  {\n    \"id\": \"card_sorting\",\n    \"name\": \"カードソート\",\n    \"description\": \"カードをカテゴリにドラッグ&ドロップで分類。\",\n    \"stage\": \"organize\",\n    \"metadata\": {\n      \"timing\": 0.35,\n      \"versatility\": 0.85,\n      \"complexity\": 0.4,\n      \"bottleneck\": [\n        \"categorization\",\n        \"grouping\",\n        \"classification\"\n      ]\n    },\n    \"ports\": {\n      \"inputs\": [\n        {\n          \"id\": \"cards\",\n          \"dataType\": \"object[]\",\n          \"description\": \"ソートするカードリスト\",\n          \"required\": false\n        }\n      ],\n      \"outputs\": [\n        {\n          \"id\": \"categories\",\n          \"dataType\": \"object\",\n          \"description\": \"カテゴリごとのカード配置\"\n        },\n        {\n          \"id\": \"uncategorized\",\n          \"dataType\": \"object[]\",\n          \"description\": \"未分類のカード\"\n        }\n      ]\n    }\n  },\n  {\n    \"id\": \"matrix_placement\",\n    \"name\": \"マトリクス配置\",\n    \"description\": \"2軸のマトリクス上にアイテムを配置し、位置関係を可視化。\",\n    \"stage\": \"organize\",\n    \"metadata\": {\n      \"timing\": 0.5,\n      \"versatility\": 0.85,\n      \"complexity\": 0.5,\n      \"bottleneck\": [\n        \"prioritization\",\n        \"comparison\",\n        \"positioning\"\n      ]\n    },\n    \"ports\": {\n      \"inputs\": [\n        {\n          \"id\": \"items\",\n          \"dataType\": \"object[]\",\n          \"description\": \"配置するアイテムリスト\",\n          \"required\": false\n        },\n        {\n          \"id\": \"axisLabels\",\n          \"dataType\": \"object\",\n          \"description\": \"軸のラベル {xAxis: {low: string, high: string}, yAxis: {low: string, high: string}}\",\n          \"required\": false\n        }\n      ],\n      \"outputs\": [\n        {\n          \"id\": \"placements\",\n          \"dataType\": \"object[]\",\n          \"description\": \"アイテムの配置情報 {id: string, x: number, y: number}\"\n        },\n        {\n          \"id\": \"quadrantCounts\",\n          \"dataType\": \"object\",\n          \"description\": \"各象限のアイテム数\"\n        }\n      ]\n    }\n  },\n  {\n    \"id\": \"timeline_view\",\n    \"name\": \"タイムライン\",\n    \"description\": \"時間軸に沿ってイベントや計画を配置。\",\n    \"stage\": \"organize\",\n    \"metadata\": {\n      \"timing\": 0.5,\n      \"versatility\": 0.7,\n      \"complexity\": 0.4,\n      \"bottleneck\": [\n        \"planning\",\n        \"scheduling\",\n        \"timeline\"\n      ]\n    },\n    \"ports\": {\n      \"inputs\": [\n        {\n          \"id\": \"events\",\n          \"dataType\": \"object[]\",\n          \"description\": \"イベントリスト\",\n          \"required\": false\n        }\n      ],\n      \"outputs\": [\n        {\n          \"id\": \"timeline\",\n          \"dataType\": \"object[]\",\n          \"description\": \"時系列に並んだイベント\"\n        },\n        {\n          \"id\": \"currentPosition\",\n          \"dataType\": \"number\",\n          \"description\": \"現在のスライダー位置\"\n        }\n      ]\n    }\n  },\n  {\n    \"id\": \"priority_slider_grid\",\n    \"name\": \"優先度スライダー\",\n    \"description\": \"複数の項目に対してスライダーで優先度を設定。\",\n    \"stage\": \"converge\",\n    \"metadata\": {\n      \"timing\": 0.7,\n      \"versatility\": 0.75,\n      \"complexity\": 0.3,\n      \"bottleneck\": [\n        \"prioritization\",\n        \"ranking\",\n        \"scoring\"\n      ]\n    },\n    \"ports\": {\n      \"inputs\": [\n        {\n          \"id\": \"items\",\n          \"dataType\": \"object[]\",\n          \"description\": \"優先度を設定する項目リスト\",\n          \"required\": false\n        }\n      ],\n      \"outputs\": [\n        {\n          \"id\": \"priorities\",\n          \"dataType\": \"object[]\",\n          \"description\": \"優先度情報 {id: string, label: string, priority: number}\"\n        },\n        {\n          \"id\": \"ranking\",\n          \"dataType\": \"string[]\",\n          \"description\": \"優先度順のID配列\"\n        }\n      ]\n    }\n  },\n  {\n    \"id\": \"decision_balance\",\n    \"name\": \"意思決定バランス\",\n    \"description\": \"2つの選択肢のメリット・デメリットを比較し、バランスを視覚化。\",\n    \"stage\": \"converge\",\n    \"metadata\": {\n      \"timing\": 0.6,\n      \"versatility\": 0.7,\n      \"complexity\": 0.5,\n      \"bottleneck\": [\n        \"comparison\",\n        \"decision\",\n        \"tradeoff\"\n      ]\n    },\n    \"ports\": {\n      \"inputs\": [\n        {\n          \"id\": \"items\",\n          \"dataType\": \"object[]\",\n          \"description\": \"比較対象の項目リスト {text: string, side: \\\"left\\\"|\\\"right\\\", weight?: number}\",\n          \"required\": false\n        }\n      ],\n      \"outputs\": [\n        {\n          \"id\": \"balance\",\n          \"dataType\": \"number\",\n          \"description\": \"バランススコア（-100〜100）\"\n        },\n        {\n          \"id\": \"direction\",\n          \"dataType\": \"string\",\n          \"description\": \"天秤の傾き方向\"\n        },\n        {\n          \"id\": \"recommendation\",\n          \"dataType\": \"string\",\n          \"description\": \"判断の推奨テキスト\"\n        }\n      ]\n    }\n  },\n  {\n    \"id\": \"action_cards\",\n    \"name\": \"アクションカード\",\n    \"description\": \"具体的なアクションをカードとして作成し、計画を立てる。\",\n    \"stage\": \"converge\",\n    \"metadata\": {\n      \"timing\": 0.8,\n      \"versatility\": 0.8,\n      \"complexity\": 0.3,\n      \"bottleneck\": [\n        \"action\",\n        \"planning\",\n        \"execution\"\n      ]\n    },\n    \"ports\": {\n      \"inputs\": [\n        {\n          \"id\": \"suggestions\",\n          \"dataType\": \"object[]\",\n          \"description\": \"アクション提案リスト\",\n          \"required\": false\n        }\n      ],\n      \"outputs\": [\n        {\n          \"id\": \"actions\",\n          \"dataType\": \"object[]\",\n          \"description\": \"アクションリスト {id: string, title: string, description?: string, deadline?: string}\"\n        },\n        {\n          \"id\": \"totalActions\",\n          \"dataType\": \"number\",\n          \"description\": \"アクションの総数\"\n        }\n      ]\n    }\n  },\n  {\n    \"id\": \"summary_view\",\n    \"name\": \"サマリービュー\",\n    \"description\": \"全ステージの結果を構造化して表示。\",\n    \"stage\": \"summary\",\n    \"metadata\": {\n      \"timing\": 0.95,\n      \"versatility\": 0.6,\n      \"complexity\": 0.2,\n      \"bottleneck\": [\n        \"summary\",\n        \"conclusion\",\n        \"synthesis\"\n      ]\n    },\n    \"ports\": {\n      \"inputs\": [\n        {\n          \"id\": \"stageResults\",\n          \"dataType\": \"object[]\",\n          \"description\": \"各ステージの結果\",\n          \"required\": true\n        }\n      ],\n      \"outputs\": [\n        {\n          \"id\": \"summary\",\n          \"dataType\": \"string\",\n          \"description\": \"生成されたサマリーテキスト\"\n        },\n        {\n          \"id\": \"keyPoints\",\n          \"dataType\": \"string[]\",\n          \"description\": \"主要ポイントのリスト\"\n        }\n      ]\n    }\n  },\n  {\n    \"id\": \"export_options\",\n    \"name\": \"エクスポート\",\n    \"description\": \"結果をさまざまな形式でエクスポート。\",\n    \"stage\": \"summary\",\n    \"metadata\": {\n      \"timing\": 1,\n      \"versatility\": 0.5,\n      \"complexity\": 0.1,\n      \"bottleneck\": [\n        \"export\",\n        \"share\",\n        \"save\"\n      ]\n    },\n    \"ports\": {\n      \"inputs\": [\n        {\n          \"id\": \"content\",\n          \"dataType\": \"object\",\n          \"description\": \"エクスポートする内容\",\n          \"required\": true\n        }\n      ],\n      \"outputs\": [\n        {\n          \"id\": \"exportedFormat\",\n          \"dataType\": \"string\",\n          \"description\": \"選択されたエクスポート形式\"\n        }\n      ]\n    }\n  },\n  {\n    \"id\": \"stage_summary\",\n    \"name\": \"ステージサマリー\",\n    \"description\": \"前ステージまでの操作内容を要約表示。\",\n    \"stage\": \"all\",\n    \"metadata\": {\n      \"timing\": 0,\n      \"versatility\": 1,\n      \"complexity\": 0.1,\n      \"bottleneck\": []\n    },\n    \"ports\": {\n      \"inputs\": [\n        {\n          \"id\": \"previousStages\",\n          \"dataType\": \"object[]\",\n          \"description\": \"前ステージの要約データ\",\n          \"required\": true\n        }\n      ],\n      \"outputs\": []\n    }\n  }\n]\n\n## タスク\n4つのステージ（diverge, organize, converge, summary）それぞれに最適なWidgetを選定してください。\n\n### 各ステージの役割\n- **diverge**: 発散フェーズ。アイデア・感情・考えを広げる。ブレインストーミング、感情の洗い出しなど。\n- **organize**: 整理フェーズ。発散した要素を分類・構造化する。カード分類、マトリクス配置など。\n- **converge**: 収束フェーズ。優先順位付け、決断、アクション化。スライダー、決断バランスなど。\n- **summary**: まとめフェーズ。整理結果のレビューと次のステップ確認。\n\n### 選定時の考慮事項\n1. **ボトルネック種別との適合性**: Widget定義のmetadata.bottleneck値を参照\n2. **ステージとの適合性**: Widget定義のstage値を参照\n3. **complexity値**: 1ステージあたりの総complexityが0.8以下が望ましい\n4. **timing値**: ステージ順序との整合性（early→middle→late）\n5. **versatility値**: 汎用性の高いWidgetは多くの場面で有効\n\n### 制約\n- 各ステージに最低1つ、最大3つのWidgetを選定\n- 同一Widget種別は1ステージにつき1回まで\n- summary ステージには summary_view または stage_summary を含める\n\n## 出力形式\n以下のJSON形式で出力してください：\n\n```json\n{\n  \"stages\": {\n    \"diverge\": {\n      \"widgets\": [\n        {\n          \"widgetId\": \"Widget種別ID\",\n          \"purpose\": \"このWidgetを選んだ目的\",\n          \"order\": 0,\n          \"suggestedConfig\": {\n            \"任意の設定キー\": \"値\"\n          },\n          \"suggestedBindings\": [\n            {\n              \"sourceWidgetType\": \"前Widgetの種別\",\n              \"outputPort\": \"出力ポートID\",\n              \"inputPort\": \"入力ポートID\"\n            }\n          ]\n        }\n      ],\n      \"purpose\": \"このステージの目的\",\n      \"target\": \"ユーザーの悩みに対してこのステージで取り組む対象\",\n      \"description\": \"このステージでの具体的なアプローチ\",\n      \"estimatedDuration\": 300\n    },\n    \"organize\": { ... },\n    \"converge\": { ... },\n    \"summary\": { ... }\n  },\n  \"rationale\": \"全体的な選定理由\",\n  \"flowDescription\": \"4ステージを通じた思考整理フローの説明\",\n  \"totalEstimatedDuration\": 1200,\n  \"metadata\": {\n    \"generatedAt\": 1764688908804,\n    \"llmModel\": \"gemini-2.5-flash\",\n    \"bottleneckType\": \"thought\"\n  }\n}\n```\n",
    "inputParams": {
      "concernText": "研究活動が楽しすぎて睡眠が疎かになってしまう",
      "bottleneckType": "thought"
    }
  }
}
# MVP要件定義書
*LLM動的UI「頭の棚卸しノート」 - 研究用プロトタイプ*

## 📖 アプリケーションコンセプト

### 基本思想：脳のキャッシュメンテナンス
「卒業研究」「友達との旅行計画」「就職活動」「ジム再開」など、頭の中に常駐している多数の関心事・気掛かりがブレインフォグを引き起こし、集中力を下げてしまう問題を解決するアプリです。

### 解決アプローチ
- **抽象的な入り口**: 「やらなきゃ」という段階で、まだ具体化されていない関心事をそのまま書き出せる
- **段階的な具体化**: 実態把握→方針立案→細分化のフローで認知負荷を分散
- **脳のワーキングメモリ拡張**: アプリに外部化することで思考の余裕を作り出す
- **procrastination対策**: 従来のタスク管理アプリより着手ハードルを大幅に下げる

### ターゲット関心事
- 成果物を求められる活動（卒業研究、プロジェクト）
- イベント・計画（旅行、引越し、就職活動）  
- 目標のある活動（部屋探し、資格取得）
- 生活習慣改善（運動再開、睡眠の質向上）

## エンジニア質問への回答

**Q: CBTフロー「実態把握→方針立案→細分化」の実装優先度は？**

**A: 「細分化」機能を最優先で実装してください。**

### 理由
1. **研究の核心測定ポイント**: ユーザが最も頻繁にインタラクションする部分
2. **動的UI効果の最大化**: タスク促し→行動報告のサイクルで新規性効果を継続測定可能
3. **比較実験の実現**: 固定UI版との着手率差異を明確に測定できる

---

## 📋 MVP機能仕様

### 🎯 研究目標との対応
- **独自性A**: UIの動的新規性制御による介入受容性向上
- **独自性B**: LLM-Hardened DSLアーキテクチャの安全な実装
- **目標1**: プロトタイプ実装完了
- **目標3**: 短期ユーザ評価の実施

### 📱 コア機能一覧

#### 1. 関心事整理システム（実態把握→方針立案→細分化）
```
- 関心事の自由入力フォーム（抽象的な入り口）
- 関心レベル・切迫度の可視化
- 関心事の性質分類支援（学習系/イベント系/習慣系/仕事系）
- アプローチタイプ提案（情報整理/具体的行動/計画・戦略）
- 2分ルール適用による具体的アクション生成
- 頭の「使用率」とスッキリ度の測定
```

#### 2. 動的促しUIシステム ⭐️最重要（細分化フェーズ）
```
- factors辞書による状況データ収集
  - 時間帯・曜日
  - 位置カテゴリ（抽象化）
  - 利用可能時間推定
  - 将来: センサーデータ（activity, calendar等）
- 優先スコア計算エンジン
  - importance, urgency, staleness, contextFit等の線形結合
- LLM-DSL UI生成API連携
- 📊 行動報告ボタン（着手測定の核心）
- プライバシー保護機能（自動取得データの抽象化）
```

#### 3. 比較実験システム
```
- 同一アプリ内でのUI切り替え機能
- A/B条件の自動割り当て（dynamic_ui vs static_ui）
- 固定UI版: 静的デザインテンプレート使用
- 動的UI版: LLM-DSL生成UI使用
- 実験条件の透明性確保（設定ファイル管理）
```

#### 4. 5画面フロー設計 🎯
```
1. 関心事入力（実態把握）
2. 関心度・切迫度測定
3. 性質分類 + アプローチ提案（方針立案）
4. 第一歩具体化（細分化）⭐️最重要測定ポイント
5. 完了フィードバック・振り返り

低優先度画面:
- アクション実行画面（タイマー機能統合版）
```

#### 5. 測定・ログシステム
```
- 着手率測定: UI表示 → 行動報告のコンバージョン率
- 頭のスッキリ度評価（3段階スケール、アクション完了後）
- ブレインフォグ改善度の自己評価
- ワーキングメモリ使用率の体感測定
- 全UIインタラクションログ
- UI生成パターンと行動の関連性追跡
```

### 📊 測定指標

**第一指標**: タスクへの着手率
- 促しUI表示回数 vs 行動報告回数  
- 動的UI版 vs 固定UI版の比較

**第二指標**: 認知負荷軽減の自己評価
- アクション完了後の頭のスッキリ度（3段階）
- ブレインフォグ改善の体感
- ワーキングメモリ使用率の変化

**補助指標**: 
- 継続利用率
- UI生成パターン別着手率
- 同タスク再着手回数

---

## 🚀 実装優先度・フェーズ（10週間計画）

### Phase 0: 環境構築・設計（Week 1-2）
1. Capacitor + React + TypeScript環境構築
2. PWA基本セットアップ
3. Bun/Honoサーバー構築
4. 5画面フロー詳細設計完成
5. データベーススキーマ確定

### Phase 1: 基盤開発（Week 3-4）
1. 5画面UI実装（React Components）
2. ローカルデータ管理（IndexedDB）
3. サーバー連携基盤
4. factors辞書システム実装
5. 基本的なCRUD操作

### Phase 2: 固定UI版（Week 5-6）
1. 細分化フェーズの促しUI（静的デザイン）
2. 2分ルールアクション生成
3. 行動報告システム
4. スッキリ度測定機能
5. A/Bテスト機構実装

### Phase 3: 動的UI版（Week 7-8）
1. LLM-DSL API連携
2. UI生成エンジン実装
3. 新規性レベル制御
4. エラーハンドリング・フォールバック機構
5. プライバシー保護機能

### Phase 4: 統合・バッファ（Week 9-10）
1. 統合テスト・デバッグ
2. パフォーマンス最適化
3. ユーザーテスト準備
4. ドキュメント整備
5. バグ修正・最終調整

### 低優先度機能（時間に余裕があれば実装）
- アクション実行画面（タイマー機能統合版）
- 高度なアニメーション
- オフライン機能強化

---

## 🔧 技術仕様要件

### アーキテクチャ
- **クライアント**: Capacitor + React + TypeScript
- **ビルド**: Vite + PWA
- **サーバー**: Bun + Hono
- **データベース**: IndexedDB（ローカル）+ SQLite（サーバー）
- **LLM**: Gemini 2.5 Mini
- **将来拡張**: ネイティブアプリ移行対応

### 技術選択理由
- **PWAベース**: 開発速度向上、Web技術活用
- **Capacitor**: ネイティブ機能アクセス、将来のApp Store対応
- **factors辞書**: センサーデータの無限拡張性
- **プライバシー分離**: ユーザ入力 vs 自動取得データの適切な処理

### API設計
```
POST /v1/ui/generate  - UI DSL生成
POST /v1/score/rank   - 優先スコア計算  
POST /v1/events/batch - イベントログ送信
GET  /v1/config       - 設定配布・実験条件
POST /v1/replay/generate - デバッグ用リプレイ
```

### セキュリティ・プライバシー
- **ユーザ明示入力**: そのまま送信（LLM判断に必要）
- **システム自動取得**: 抽象化して送信（factors辞書活用）
- **個人特定情報**: ローカル保存のみ
- **UI生成**: 安全性検証済みDSL v1.1のみ
- **通信**: TLS暗号化必須
- **匿名化**: ハッシュ化ユーザーID使用

---

## ❌ MVP範囲外（後回し）

- 高度な個人化機能（プリセット重みで十分）
- 高度なパーソナライゼーション
- 長期的な学習・適応機能
- ゲーミフィケーション要素
- ソーシャル機能

---

## 📝 実装メモ

### 着手の定義
**「行動報告ボタンをタップした瞬間」** = 着手とみなす
- UIでの促し表示から報告までの時間を測定
- 報告内容の検証は行わない（自己申告ベース）
- 完了時に「頭のスッキリ度」も同時測定

### 新しい測定要素
**頭の使用率**: 関心事がどれくらい思考を占めているかの主観的評価
**スッキリ度**: アクション完了後の認知負荷軽減の体感
**アプリ離脱時のブレインフォグ状態**: セッション終了時の頭の整理状況

### factors辞書システム
**拡張可能なコンテキストデータ:**
```typescript
factors: Record<string, {
  value: string | number | boolean
  confidence?: number    // データ精度 0-1
  source?: string       // 取得元
  timestamp?: Date      // 取得時刻
}>
```
**初期実装factors**: location_category, time_of_day, available_time
**将来拡張**: motion, calendar, biometric等を型定義変更なしに追加

### プライバシー設計
**ユーザ明示入力**: そのまま送信（concernText, 選択項目等）
**システム自動取得**: 抽象化して送信（home/work, busy/free等）
**完全ローカル**: 個人特定可能情報（位置座標、具体的予定等）

### ユーザ評価サイクル
- **期間**: 1週間程度
- **頻度**: ユーザのペースに任せる  
- **対象者**: 5名程度の短期評価
- **開発期間**: 10週間（2ヶ月+2週間バッファ）

### 測定可能性の確保
- 全インタラクションにタイムスタンプ
- UI生成リクエスト〜表示〜行動報告の追跡ID付与
- 再現可能な実験条件の記録（configVersion管理）
- A/B条件の透明性（設定ファイルベース割り当て）

---

*作成日: 2025年9月15日*  
*最終更新: 2025年9月17日*  
*バージョン: v2.0（Capacitor + React + factors辞書対応）*

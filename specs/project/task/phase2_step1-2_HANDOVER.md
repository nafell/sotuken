# Phase 2 å®Ÿè£…å®Œäº† å¼•ãç¶™ãè³‡æ–™

**ä½œæˆæ—¥**: 2025å¹´10æœˆ18æ—¥  
**ä½œæˆè€…**: AI Agent (Claude Sonnet 4.5)  
**å¯¾è±¡ãƒ•ã‚§ãƒ¼ã‚º**: Phase 2 Step 1-2 å®Œäº†ç‰ˆ  
**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: é–¢å¿ƒäº‹è§£æ¶ˆã‚¢ãƒ—ãƒª - ç€æ‰‹ç‡æ¸¬å®šæ©Ÿèƒ½

---

## ğŸ“‹ ç›®æ¬¡

1. [å®Ÿè£…æ¦‚è¦](#å®Ÿè£…æ¦‚è¦)
2. [ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ](#ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ)
3. [å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½](#å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½)
4. [ç’°å¢ƒãƒ»ä¾å­˜é–¢ä¿‚](#ç’°å¢ƒä¾å­˜é–¢ä¿‚)
5. [å•é¡Œå¯¾å‡¦å±¥æ­´](#å•é¡Œå¯¾å‡¦å±¥æ­´)
6. [é‡è¦ãªç•™æ„ç‚¹](#é‡è¦ãªç•™æ„ç‚¹)
7. [æœªå®Ÿè£…æ©Ÿèƒ½](#æœªå®Ÿè£…æ©Ÿèƒ½)
8. [ãƒ†ã‚¹ãƒˆæ‰‹é †](#ãƒ†ã‚¹ãƒˆæ‰‹é †)
9. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)
10. [æ¬¡ã®ä½œæ¥­è€…ã¸](#æ¬¡ã®ä½œæ¥­è€…ã¸)

---

## å®Ÿè£…æ¦‚è¦

### ğŸ¯ é”æˆç›®æ¨™

Phase 2ã®ç›®çš„ã§ã‚ã‚‹ **ã€Œå‹•çš„UIã¨å›ºå®šUIã®ç€æ‰‹ç‡æ¯”è¼ƒå®Ÿé¨“ã€** ã®åŸºç›¤ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚

**å®Ÿè£…ç¯„å›²**:
- âœ… **Step 1**: ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ãƒ»APIçµ±åˆï¼ˆå®Œäº†ï¼‰
- âœ… **Step 2**: ã‚¿ã‚¹ã‚¯æ¨å¥¨ç”»é¢ï¼ˆå‹•çš„UIç‰ˆï¼‰ï¼ˆå®Œäº†ï¼‰
- â³ **Step 3**: æ€è€ƒæ•´ç†ãƒ•ãƒ­ãƒ¼çµ±åˆï¼ˆæœªå®Ÿæ–½ï¼‰
- â³ **Step 4**: A/Bãƒ†ã‚¹ãƒˆæ©Ÿæ§‹ï¼ˆæœªå®Ÿæ–½ï¼‰
- â³ **Step 5**: å›ºå®šUIç‰ˆæ•´å‚™ï¼ˆæœªå®Ÿæ–½ï¼‰
- â³ **Step 6**: æ¸¬å®šãƒ»ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ ï¼ˆæœªå®Ÿæ–½ï¼‰

### ğŸ“Š å®Ÿè£…çµ±è¨ˆ

| é …ç›® | æ•°å€¤ |
|------|------|
| æ–°è¦ä½œæˆãƒ•ã‚¡ã‚¤ãƒ« | 14ãƒ•ã‚¡ã‚¤ãƒ« |
| ç·ã‚³ãƒ¼ãƒ‰è¡Œæ•° | ç´„3,500è¡Œ |
| ã‚³ãƒŸãƒƒãƒˆæ•° | 8ã‚³ãƒŸãƒƒãƒˆ |
| å®Ÿè£…æœŸé–“ | 1æ—¥ï¼ˆé›†ä¸­å®Ÿè£…ï¼‰ |
| ãƒ†ã‚¹ãƒˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | 4ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ1,797è¡Œï¼‰ |

---

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

### ğŸ“‚ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ï¼ˆconcern-app/ï¼‰

#### æ–°è¦ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«

```
concern-app/src/
â”œâ”€â”€ types/
â”‚   â””â”€â”€ database.ts                 [æ‹¡å¼µ] Task, ActionReportå‹è¿½åŠ 
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ TaskService.ts              [æ–°è¦] ã‚¿ã‚¹ã‚¯æ“ä½œã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”œâ”€â”€ EventLogger.ts              [æ–°è¦] ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â””â”€â”€ database/
â”‚       â””â”€â”€ localDB.ts              [æ‹¡å¼µ] IndexedDB v2ã‚¹ã‚­ãƒ¼ãƒå®Ÿè£…
â”œâ”€â”€ screens/
â”‚   â”œâ”€â”€ TaskRecommendationScreen.tsx [æ–°è¦] ã‚¿ã‚¹ã‚¯æ¨å¥¨ç”»é¢
â”‚   â”œâ”€â”€ TaskListScreen.tsx          [æ–°è¦] ã‚¿ã‚¹ã‚¯ä¸€è¦§ç”»é¢
â”‚   â””â”€â”€ TaskCreateScreen.tsx        [æ–°è¦] ã‚¿ã‚¹ã‚¯ä½œæˆç”»é¢
â””â”€â”€ components/
    â”œâ”€â”€ ActionReportModal.tsx       [æ–°è¦] è¡Œå‹•å ±å‘Šãƒ¢ãƒ¼ãƒ€ãƒ«
    â””â”€â”€ ClarityFeedbackModal.tsx    [æ–°è¦] ã‚¹ãƒƒã‚­ãƒªåº¦æ¸¬å®šãƒ¢ãƒ¼ãƒ€ãƒ«
```

#### ãƒ•ã‚¡ã‚¤ãƒ«è©³ç´°

**1. types/database.ts** (152è¡Œè¿½åŠ )
- `Task` interface: ã‚¿ã‚¹ã‚¯ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®å®Œå…¨ãªå‹å®šç¾©
- `ActionReport` interface: è¡Œå‹•å ±å‘Šè¨˜éŒ²ã®å‹å®šç¾©
- `EventType`: 9ç¨®é¡ã®æ–°ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—è¿½åŠ 
- ç€æ‰‹ç‡æ¸¬å®šã«å¿…è¦ãªå…¨ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’å®šç¾©

**2. services/TaskService.ts** (85è¡Œ)
- Task CRUDæ“ä½œã®æŠ½è±¡åŒ–ãƒ¬ã‚¤ãƒ¤ãƒ¼
- `createTask()`, `getActiveTasks()`, `updateTask()`, `deleteTask()`
- `getCompletedTasks()`, `getArchivedTasks()`
- LocalDatabaseã¨ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

**3. services/EventLogger.ts** (139è¡Œ)
- ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°è¨˜éŒ²ã®ä¸­æ ¸ã‚µãƒ¼ãƒ“ã‚¹
- ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°æ©Ÿèƒ½ï¼ˆ10ã‚¤ãƒ™ãƒ³ãƒˆã¾ãŸã¯30ç§’ï¼‰
- Beacon APIå¯¾å¿œï¼ˆãƒšãƒ¼ã‚¸é›¢è„±æ™‚ã‚‚é€ä¿¡ï¼‰
- ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…æ¸ˆã¿

**4. services/database/localDB.ts** (186è¡Œè¿½åŠ )
- IndexedDB v2ã‚¹ã‚­ãƒ¼ãƒå®šç¾©
- `tasks`, `actionReports` ãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ 
- Task CRUD: `createTask()`, `getActiveTasks()`, `getStaleTasks()`
- ActionReport: `startAction()`, `completeAction()`
- **é‡è¦**: `timeToStartSec` ã®è‡ªå‹•è¨ˆç®—å®Ÿè£…

**5. screens/TaskRecommendationScreen.tsx** (352è¡Œ)
- ã‚¿ã‚¹ã‚¯æ¨å¥¨ã®ãƒ¡ã‚¤ãƒ³ç”»é¢
- Factorså…¥åŠ›ï¼ˆå ´æ‰€ãƒ»æ™‚é–“å¸¯ãƒ»åˆ©ç”¨å¯èƒ½æ™‚é–“ï¼‰
- `/v1/task/rank` APIçµ±åˆ
- `task_recommendation_shown` ã‚¤ãƒ™ãƒ³ãƒˆè¨˜éŒ²
- **é‡è¦**: `recommendationShownAt` ã‚’ state ã§ç®¡ç†

**6. components/ActionReportModal.tsx** (140è¡Œ)
- ä½œæ¥­ä¸­ã‚¿ã‚¤ãƒãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ«
- 1ç§’ã”ã¨ã®ã‚¿ã‚¤ãƒãƒ¼æ›´æ–°
- ã€Œå®Œäº†ã—ã¾ã—ãŸã€ã€Œä¸­æ–­ã€ãƒœã‚¿ãƒ³
- åˆ†:ç§’å½¢å¼ã®æ™‚é–“è¡¨ç¤º

**7. components/ClarityFeedbackModal.tsx** (225è¡Œ)
- ã‚¹ãƒƒã‚­ãƒªåº¦æ¸¬å®šãƒ¢ãƒ¼ãƒ€ãƒ«
- 3æ®µéšè©•ä¾¡ï¼ˆ1: ğŸ˜, 2: ğŸ™‚, 3: ğŸ˜Šï¼‰
- ãƒ¡ãƒ¢å…¥åŠ›æ©Ÿèƒ½
- `completeAction()` å‘¼ã³å‡ºã—
- `task_action_completed`, `clarity_feedback_submitted` ã‚¤ãƒ™ãƒ³ãƒˆè¨˜éŒ²

**8. screens/TaskListScreen.tsx** (229è¡Œ)
- ã‚¿ã‚¹ã‚¯ä¸€è¦§è¡¨ç¤º
- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆï¼ˆã‚¢ã‚¯ãƒ†ã‚£ãƒ–/å®Œäº†/ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ï¼‰
- ã‚¿ã‚¹ã‚¯å®Œäº†ãƒ»å‰Šé™¤æ©Ÿèƒ½

**9. screens/TaskCreateScreen.tsx** (200è¡Œ)
- ã‚¿ã‚¹ã‚¯ä½œæˆãƒ•ã‚©ãƒ¼ãƒ 
- ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼UIï¼ˆé‡è¦åº¦ãƒ»ç·Šæ€¥åº¦ï¼‰
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…

---

### ğŸ–¥ï¸ ã‚µãƒ¼ãƒãƒ¼å´ï¼ˆserver/ï¼‰

#### æ–°è¦ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«

```
server/src/
â”œâ”€â”€ types/
â”‚   â”œâ”€â”€ Task.ts                     [æ–°è¦] ã‚µãƒ¼ãƒãƒ¼å´Taskå‹
â”‚   â””â”€â”€ ActionReport.ts             [æ–°è¦] ã‚µãƒ¼ãƒãƒ¼å´ActionReportå‹
â”œâ”€â”€ services/
â”‚   â””â”€â”€ ExperimentService.ts        [æ–°è¦] å®Ÿé¨“æ¡ä»¶ç®¡ç†ã‚µãƒ¼ãƒ“ã‚¹
â””â”€â”€ routes/
    â”œâ”€â”€ config.ts                   [æ‹¡å¼µ] /v1/config APIå®Ÿè£…
    â””â”€â”€ events.ts                   [æ‹¡å¼µ] Phase 2ã‚¤ãƒ™ãƒ³ãƒˆå¯¾å¿œ
```

#### ãƒ•ã‚¡ã‚¤ãƒ«è©³ç´°

**1. types/Task.ts** (128è¡Œ)
- SQLiteç”¨Taskå‹å®šç¾©
- JSONæ–‡å­—åˆ—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å¯¾å¿œ
- CreateTaskRequest, UpdateTaskRequestå‹

**2. types/ActionReport.ts** (88è¡Œ)
- SQLiteç”¨ActionReportå‹å®šç¾©
- CreateActionReportRequestå‹
- EngagementMetricså‹ï¼ˆç€æ‰‹ç‡è¨ˆç®—çµæœï¼‰

**3. services/ExperimentService.ts** (120è¡Œ)
- ãƒãƒƒã‚·ãƒ¥ãƒ™ãƒ¼ã‚¹æ¡ä»¶å‰²ã‚Šå½“ã¦
- SHA-256ã«ã‚ˆã‚‹50:50åˆ†å‰²
- æ¡ä»¶ã®ä¸€è²«æ€§ä¿è¨¼ï¼ˆåŒã˜ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã§å¸¸ã«åŒã˜æ¡ä»¶ï¼‰
- æ‰‹å‹•åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰

**4. routes/config.ts** (æ‹¡å¼µ)
- ExperimentServiceçµ±åˆ
- `getOrAssignCondition()` å‘¼ã³å‡ºã—
- å®Ÿé¨“æ¡ä»¶ã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å«ã‚ã‚‹

**5. routes/events.ts** (æ‹¡å¼µ)
- Phase 2ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—è¿½åŠ ï¼ˆ9ç¨®é¡ï¼‰
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¼·åŒ–

---

### ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆspecs/ï¼‰

```
specs/
â”œâ”€â”€ testing/
â”‚   â”œâ”€â”€ README.md                   [æ–°è¦] ãƒ†ã‚¹ãƒˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç´¢å¼•
â”‚   â”œâ”€â”€ phase2_user_testing_plan.md [æ–°è¦] è©³ç´°ãƒ†ã‚¹ãƒˆè¨ˆç”»ï¼ˆ739è¡Œï¼‰
â”‚   â”œâ”€â”€ quick_test_guide.md         [æ–°è¦] ã‚¯ã‚¤ãƒƒã‚¯ãƒ†ã‚¹ãƒˆï¼ˆ184è¡Œï¼‰
â”‚   â””â”€â”€ debug_commands.md           [æ–°è¦] ãƒ‡ãƒãƒƒã‚°ã‚³ãƒãƒ³ãƒ‰é›†ï¼ˆ586è¡Œï¼‰
â””â”€â”€ project/
    â””â”€â”€ task/
        â””â”€â”€ phase2_detailed_tasks.md [å‚ç…§] å®Ÿè£…ã‚¿ã‚¹ã‚¯ä¸€è¦§
```

---

## å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½

### ğŸ¯ æ ¸å¿ƒæ©Ÿèƒ½

#### 1. ç€æ‰‹ç‡æ¸¬å®šï¼ˆæœ€é‡è¦ï¼‰

**å®Ÿè£…ç®‡æ‰€**: 
- `TaskRecommendationScreen.tsx` ã® `handleActionStart()`
- `localDB.ts` ã® `startAction()`

**å‹•ä½œãƒ•ãƒ­ãƒ¼**:
```
1. TaskRecommendationScreenè¡¨ç¤º
   â†“
2. recommendationShownAt ã‚’ state ã«ä¿å­˜ â­ï¸
   â†“
3. task_recommendation_shown ã‚¤ãƒ™ãƒ³ãƒˆè¨˜éŒ²
   â†“
4. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œç€æ‰‹ã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
   â†“
5. ç¾åœ¨æ™‚åˆ» - recommendationShownAt = timeToStartSec â­ï¸
   â†“
6. ActionReportä½œæˆï¼ˆIndexedDBã«ä¿å­˜ï¼‰
   â†“
7. task_action_started ã‚¤ãƒ™ãƒ³ãƒˆè¨˜éŒ²
```

**é‡è¦ãƒ‡ãƒ¼ã‚¿**:
- `timeToStartSec`: è¡¨ç¤ºã‹ã‚‰ç€æ‰‹ã¾ã§ã®çµŒéæ™‚é–“ï¼ˆç§’ï¼‰
- ç²¾åº¦: ãƒŸãƒªç§’å˜ä½ã§è¨ˆç®—ã€ç§’å˜ä½ã§è¨˜éŒ²
- ç”¨é€”: å‹•çš„UI vs å›ºå®šUIã®ç€æ‰‹ç‡æ¯”è¼ƒ

**æ¤œè¨¼æ–¹æ³•**:
```javascript
const report = await db.actionReports.toArray();
console.log('Time to start:', report[0].timeToStartSec, 'seconds');
// æœŸå¾…å€¤: å®Ÿéš›ã®å¾…æ©Ÿæ™‚é–“ Â±1ç§’
```

#### 2. ã‚¹ãƒƒã‚­ãƒªåº¦æ¸¬å®š

**å®Ÿè£…ç®‡æ‰€**: 
- `ClarityFeedbackModal.tsx`
- `localDB.ts` ã® `completeAction()`

**3æ®µéšè©•ä¾¡**:
- 1: ã‚ã¾ã‚Šã‚¹ãƒƒã‚­ãƒªã—ãªã„ ğŸ˜
- 2: å°‘ã—ã‚¹ãƒƒã‚­ãƒª ğŸ™‚
- 3: ã‹ãªã‚Šã‚¹ãƒƒã‚­ãƒª ğŸ˜Š

**è¨˜éŒ²ãƒ‡ãƒ¼ã‚¿**:
- `clarityImprovement`: 1-3ã®æ•´æ•°å€¤
- `durationMin`: ä½œæ¥­æ‰€è¦æ™‚é–“ï¼ˆåˆ†ï¼‰
- `notes`: è‡ªç”±è¨˜è¿°ï¼ˆä»»æ„ï¼‰

#### 3. ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ 

**å®Ÿè£…ç®‡æ‰€**: `EventLogger.ts`

**æ–°è¦ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—**:
- `task_recommendation_shown`: ã‚¿ã‚¹ã‚¯æ¨å¥¨è¡¨ç¤º
- `task_action_started`: ã‚¿ã‚¹ã‚¯ç€æ‰‹ â­ï¸
- `task_action_completed`: ã‚¿ã‚¹ã‚¯å®Œäº†
- `clarity_feedback_submitted`: ã‚¹ãƒƒã‚­ãƒªåº¦å ±å‘Š
- `task_created`: ã‚¿ã‚¹ã‚¯ä½œæˆ
- `task_updated`: ã‚¿ã‚¹ã‚¯æ›´æ–°
- `task_deleted`: ã‚¿ã‚¹ã‚¯å‰Šé™¤
- `experiment_condition_assigned`: å®Ÿé¨“æ¡ä»¶å‰²ã‚Šå½“ã¦
- `experiment_condition_switched`: å®Ÿé¨“æ¡ä»¶åˆ‡ã‚Šæ›¿ãˆ

**ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°ä»•æ§˜**:
- ãƒãƒƒãƒ•ã‚¡ã‚µã‚¤ã‚º: 10ã‚¤ãƒ™ãƒ³ãƒˆ
- ãƒ•ãƒ©ãƒƒã‚·ãƒ¥é–“éš”: 30ç§’
- ãƒšãƒ¼ã‚¸é›¢è„±æ™‚: Beacon APIä½¿ç”¨

#### 4. å®Ÿé¨“æ¡ä»¶å‰²ã‚Šå½“ã¦

**å®Ÿè£…ç®‡æ‰€**: `ExperimentService.ts`

**ãƒãƒƒã‚·ãƒ¥ãƒ™ãƒ¼ã‚¹å‰²ã‚Šå½“ã¦**:
```typescript
const hash = crypto.createHash('sha256').update(userId).digest('hex');
const lastByte = parseInt(hash.slice(-2), 16);
return lastByte % 2 === 0 ? 'dynamic_ui' : 'static_ui';
```

**ç‰¹å¾´**:
- æ±ºå®šè«–çš„ï¼ˆåŒã˜ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã§å¸¸ã«åŒã˜æ¡ä»¶ï¼‰
- 50:50ã®ç¢ºç‡åˆ†å¸ƒ
- ã‚µãƒ¼ãƒãƒ¼å´ã§ç®¡ç†
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥

---

## ç’°å¢ƒãƒ»ä¾å­˜é–¢ä¿‚

### é–‹ç™ºç’°å¢ƒ

```
OS: Linux 5.15.0-157-generic
Node.js: v20ä»¥ä¸Šæ¨å¥¨
ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼: Bun
```

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆconcern-app/ï¼‰

**ä¸»è¦ä¾å­˜**:
```json
{
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "dexie": "^3.2.4",
    "react-router-dom": "^6.x"
  },
  "devDependencies": {
    "typescript": "^5.0.0",
    "vite": "^4.4.0"
  }
}
```

**é‡è¦**:
- Dexie: IndexedDBæ“ä½œãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- ãƒãƒ¼ã‚¸ãƒ§ãƒ³2ã‚¹ã‚­ãƒ¼ãƒã‚’ä½¿ç”¨
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è‡ªå‹•å®Ÿè¡Œ

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆserver/ï¼‰

**ä¸»è¦ä¾å­˜**:
```json
{
  "dependencies": {
    "hono": "^3.x",
    "@google/generative-ai": "^0.x"
  }
}
```

**ãƒãƒ¼ãƒˆ**:
- é–‹ç™º: 3000
- æœ¬ç•ª: ç’°å¢ƒå¤‰æ•° `PORT`

### èµ·å‹•æ–¹æ³•

```bash
# ã‚µãƒ¼ãƒãƒ¼ï¼ˆã‚¿ãƒ¼ãƒŸãƒŠãƒ«1ï¼‰
cd /home/tk220307/sotuken/server
bun run dev

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆã‚¿ãƒ¼ãƒŸãƒŠãƒ«2ï¼‰
cd /home/tk220307/sotuken/concern-app
bun run dev

# ã‚¢ã‚¯ã‚»ã‚¹
# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: http://localhost:5173
# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰: http://localhost:3000
```

---

## å•é¡Œå¯¾å‡¦å±¥æ­´

### ğŸ› ç™ºç”Ÿã—ãŸå•é¡Œã¨è§£æ±ºæ–¹æ³•

#### å•é¡Œ1: IndexedDB ã‚¹ã‚­ãƒ¼ãƒãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†

**ç—‡çŠ¶**: 
- v1ã‹ã‚‰v2ã¸ã®ç§»è¡Œæ™‚ã«ã‚¨ãƒ©ãƒ¼
- æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ãˆãªããªã‚‹

**åŸå› **:
- Dexieã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³å®šç¾©ãŒä¸å®Œå…¨
- æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’v2ã§å†å®šç¾©ã—ã¦ã„ãªã„

**è§£æ±º**:
```typescript
// localDB.ts
this.version(1).stores({ /* æ—¢å­˜ã‚¹ã‚­ãƒ¼ãƒ */ });
this.version(2).stores({ 
  /* æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ã‚‚å«ã‚ã‚‹ */
  tasks: 'taskId, userId, status...',
  actionReports: 'reportId, taskId, userId...'
});
```

**æ•™è¨“**: æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§å…¨ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å†å®šç¾©ã™ã‚‹å¿…è¦ã‚ã‚Š

---

#### å•é¡Œ2: timeToStartSec ãŒ 0 ã«ãªã‚‹

**ç—‡çŠ¶**: 
- ActionReportã®`timeToStartSec`ãŒå¸¸ã«0

**åŸå› **:
- `recommendationShownAt`ãŒundefined
- ã‚¿ã‚¹ã‚¯æ¨å¥¨è¡¨ç¤ºæ™‚ã«ä¿å­˜ã—å¿˜ã‚Œ

**è§£æ±º**:
```typescript
// TaskRecommendationScreen.tsx
const shownAt = new Date();
setRecommendationShownAt(shownAt); // â­ï¸ å¿…é ˆ
```

**æ•™è¨“**: ç€æ‰‹æ¸¬å®šã®åŸºæº–æ™‚åˆ»ã¯å¿…ãšä¿å­˜

---

#### å•é¡Œ3: ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ï¼ˆæ—¢å­˜ã®å•é¡Œï¼‰

**ç—‡çŠ¶**: 
- `bun run build`ã§æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã®TypeScriptã‚¨ãƒ©ãƒ¼

**å½±éŸ¿ç¯„å›²**:
- `DatabaseTest.tsx`, `FactorsTest.tsx`ç­‰
- Phase 0-1ã®æœªä¿®æ­£ã‚¨ãƒ©ãƒ¼

**å¯¾å‡¦**:
- æ–°è¦å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯å½±éŸ¿ãªã—
- æ—¢å­˜ã‚¨ãƒ©ãƒ¼ã¯æ”¾ç½®ï¼ˆPhase 2ã®å®Ÿè£…ã«ç„¡é–¢ä¿‚ï¼‰

**å°†æ¥ã®å¯¾å¿œ**: Phase 3ã§æ—¢å­˜ã‚¨ãƒ©ãƒ¼ã‚’ä¿®æ­£æ¨å¥¨

---

#### å•é¡Œ4: EventLoggerã®ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯æ‡¸å¿µ

**ç—‡çŠ¶**: 
- ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒƒãƒ•ã‚¡ãŒç„¡é™ã«è“„ç©ã™ã‚‹å¯èƒ½æ€§

**å¯¾ç­–å®Ÿè£…**:
```typescript
// EventLogger.ts
- setInterval ã§ã‚¿ã‚¤ãƒãƒ¼ç®¡ç†
- beforeunload ã§ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
- flushSync() ã§ç¢ºå®Ÿã«é€ä¿¡
```

**ç¾çŠ¶**: ãƒªãƒ¼ã‚¯å¯¾ç­–å®Ÿè£…æ¸ˆã¿

---

#### å•é¡Œ5: API CORS ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: 
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰ã®APIå‘¼ã³å‡ºã—ãŒãƒ–ãƒ­ãƒƒã‚¯

**è§£æ±ºæ¸ˆã¿**:
```typescript
// server/src/index.ts
app.use('*', cors({
  origin: ['http://localhost:5173', ...],
  credentials: true
}));
```

**ç¢ºèª**: æ—¢ã«å®Ÿè£…æ¸ˆã¿

---

## é‡è¦ãªç•™æ„ç‚¹

### âš ï¸ å¿…èª­äº‹é …

#### 1. timeToStartSec ã®ç²¾åº¦ç®¡ç†

**é‡è¦åº¦**: â­ï¸â­ï¸â­ï¸

```typescript
// å¿…ãš Date ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§è¨˜éŒ²
const shownAt = new Date(); // â­ï¸
setRecommendationShownAt(shownAt);

// è¨ˆç®—ã¯ãƒŸãƒªç§’å˜ä½
const timeToStartSec = (now.getTime() - recommendationShownAt.getTime()) / 1000;
```

**ãƒã‚§ãƒƒã‚¯é …ç›®**:
- [ ] `recommendationShownAt` ãŒ null ã§ãªã„
- [ ] ã‚¿ã‚¹ã‚¯æ¨å¥¨è¡¨ç¤ºæ™‚ã«å¿…ãšè¨­å®š
- [ ] ç€æ‰‹ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚ã«ä½¿ç”¨
- [ ] èª¤å·®Â±1ç§’ä»¥å†…ã‚’ç¶­æŒ

---

#### 2. IndexedDB ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

**é‡è¦**: ã‚¹ã‚­ãƒ¼ãƒãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†

```typescript
// æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³è¿½åŠ æ™‚ã¯å…¨ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å†å®šç¾©
this.version(3).stores({
  // æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ã‚‚å«ã‚ã‚‹
  userProfile: '...',
  tasks: '...',
  actionReports: '...',
  // æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«
  newTable: '...'
});
```

**ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢æ–¹æ³•**:
```javascript
indexedDB.deleteDatabase('ConcernApp');
location.reload();
```

---

#### 3. ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ã®è¨˜éŒ²ã‚¿ã‚¤ãƒŸãƒ³ã‚°

**å¿…é ˆã‚¤ãƒ™ãƒ³ãƒˆ**:

| ã‚¤ãƒ™ãƒ³ãƒˆ | ã‚¿ã‚¤ãƒŸãƒ³ã‚° | è¨˜éŒ²å ´æ‰€ |
|---------|-----------|----------|
| task_recommendation_shown | æ¨å¥¨è¡¨ç¤ºæ™‚ | `fetchRecommendation()` |
| task_action_started | ç€æ‰‹ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚ | `handleActionStart()` |
| task_action_completed | å®Œäº†å ±å‘Šæ™‚ | `ClarityFeedbackModal` |
| clarity_feedback_submitted | ã‚¹ãƒƒã‚­ãƒªåº¦é€ä¿¡æ™‚ | `ClarityFeedbackModal` |

**æ¼ã‚Œãƒã‚§ãƒƒã‚¯**:
```javascript
// Console ã§ç¢ºèª
const events = await db.interactionEvents.toArray();
console.log('Event types:', events.map(e => e.eventType));
```

---

#### 4. å®Ÿé¨“æ¡ä»¶ã®ä¸€è²«æ€§

**é‡è¦**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã«æ¡ä»¶ã‚’å›ºå®š

```typescript
// ExperimentService.ts
// ãƒãƒƒã‚·ãƒ¥ãƒ™ãƒ¼ã‚¹ã§æ±ºå®šè«–çš„ã«å‰²ã‚Šå½“ã¦
// â†’ åŒã˜ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã§å¸¸ã«åŒã˜æ¡ä»¶
```

**æ¤œè¨¼æ–¹æ³•**:
```bash
# åŒã˜ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã§è¤‡æ•°å›å®Ÿè¡Œ
curl -H "X-User-ID: test123" http://localhost:3000/v1/config
# å¸¸ã«åŒã˜ condition ãŒè¿”ã•ã‚Œã‚‹
```

---

#### 5. React State ç®¡ç†

**æ³¨æ„**: ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºçŠ¶æ…‹ã®ç®¡ç†

```typescript
// TaskRecommendationScreen.tsx
const [showActionModal, setShowActionModal] = useState(false);
const [showClarityModal, setShowClarityModal] = useState(false);

// é †åº: ActionModal â†’ ClarityModal
setShowActionModal(false);
setShowClarityModal(true); // åŒæ™‚ã«é–‹ã‹ãªã„
```

---

#### 6. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è€ƒæ…®äº‹é …

**IndexedDB ã‚¯ã‚¨ãƒª**:
```typescript
// âŒ é…ã„
const allTasks = await db.tasks.toArray();
const activeTasks = allTasks.filter(t => t.status === 'active');

// âœ… é€Ÿã„ï¼ˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½¿ç”¨ï¼‰
const activeTasks = await db.tasks
  .where('[userId+status]')
  .equals([userId, 'active'])
  .toArray();
```

**è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æ´»ç”¨**:
- `[userId+status]`
- `[userId+lastTouchAt]`
- `[taskId+actionStartedAt]`

---

#### 7. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

**å¿…é ˆ**: å…¨ async é–¢æ•°ã§ try-catch

```typescript
try {
  await db.createTask(taskData);
} catch (error) {
  console.error('âŒ Task creation failed:', error);
  alert('ã‚¿ã‚¹ã‚¯ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ');
  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é€šçŸ¥
}
```

---

#### 8. å‹å®‰å…¨æ€§

**TypeScript å³æ ¼ãƒ¢ãƒ¼ãƒ‰**:
```typescript
// âŒ é¿ã‘ã‚‹
const task: any = await db.tasks.get(taskId);

// âœ… æ¨å¥¨
const task: Task | undefined = await db.tasks.get(taskId);
if (!task) {
  throw new Error('Task not found');
}
```

---

## æœªå®Ÿè£…æ©Ÿèƒ½

### â³ Step 3: æ€è€ƒæ•´ç†ãƒ•ãƒ­ãƒ¼çµ±åˆï¼ˆ4-5æ—¥ï¼‰

**æ¦‚è¦**: Phase 1Cã§å®Ÿè£…ã—ãŸDynamicThoughtScreenã¨çµ±åˆ

**ä¸»è¦ã‚¿ã‚¹ã‚¯**:
- [ ] DynamicUINavigatorä½œæˆ
- [ ] ConcernFlowStateManagerä½œæˆ
- [ ] breakdownçµæœã‹ã‚‰Taskç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯
- [ ] é–¢å¿ƒäº‹å…¥åŠ›â†’ã‚¿ã‚¹ã‚¯æ¨å¥¨ã®å®Œå…¨ãƒ•ãƒ­ãƒ¼

**ãƒ•ã‚¡ã‚¤ãƒ«**:
- `navigators/DynamicUINavigator.tsx`
- `services/ConcernFlowStateManager.ts`
- `services/TaskGenerationService.ts`

---

### â³ Step 4: A/Bãƒ†ã‚¹ãƒˆæ©Ÿæ§‹ï¼ˆ3-4æ—¥ï¼‰

**æ¦‚è¦**: å‹•çš„UI vs å›ºå®šUIã®æ¡ä»¶åˆ†å²

**ä¸»è¦ã‚¿ã‚¹ã‚¯**:
- [ ] ClientExperimentServiceå®Ÿè£…
- [ ] App.tsxã§æ¡ä»¶åˆ¥ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- [ ] StaticUINavigatorä½œæˆ
- [ ] SettingsScreenå®Ÿè£…ï¼ˆæ¡ä»¶è¡¨ç¤ºãƒ»åˆ‡ã‚Šæ›¿ãˆï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**:
- `services/ExperimentService.ts` (ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´)
- `App.tsx`
- `navigators/StaticUINavigator.tsx`
- `screens/SettingsScreen.tsx`

---

### â³ Step 5: å›ºå®šUIç‰ˆæ•´å‚™ï¼ˆ3-4æ—¥ï¼‰

**æ¦‚è¦**: å›ºå®šUIãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®å®Ÿè£…

**ä¸»è¦ã‚¿ã‚¹ã‚¯**:
- [ ] StaticTaskRecommendationScreenå®Ÿè£…
- [ ] StaticTaskCard componentå®Ÿè£…
- [ ] å›ºå®šãƒ‡ã‚¶ã‚¤ãƒ³ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå®šç¾©
- [ ] uiCondition='static_ui' ã§ã‚¤ãƒ™ãƒ³ãƒˆè¨˜éŒ²

**ãƒ•ã‚¡ã‚¤ãƒ«**:
- `screens/StaticTaskRecommendationScreen.tsx`
- `components/StaticTaskCard.tsx`
- `styles/StaticTaskCardStyles.ts`

---

### â³ Step 6: æ¸¬å®šãƒ»ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ ï¼ˆ2-3æ—¥ï¼‰

**æ¦‚è¦**: ã‚µãƒ¼ãƒãƒ¼å´ã®åˆ†ææ©Ÿèƒ½

**ä¸»è¦ã‚¿ã‚¹ã‚¯**:
- [ ] EventLoggerãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°å®Œæˆ
- [ ] MetricsServiceå®Ÿè£…
- [ ] GET /v1/metrics/engagement API
- [ ] AdminDashboardå®Ÿè£…

**ãƒ•ã‚¡ã‚¤ãƒ«**:
- `server/src/services/MetricsService.ts`
- `server/src/routes/metrics.ts`
- `concern-app/src/screens/AdminDashboard.tsx`

---

## ãƒ†ã‚¹ãƒˆæ‰‹é †

### ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ãƒ†ã‚¹ãƒˆï¼ˆ15åˆ†ï¼‰

**è©³ç´°**: `specs/testing/quick_test_guide.md`

```bash
# 1. ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
cd /home/tk220307/sotuken/server && bun run dev

# 2. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰èµ·å‹•
cd /home/tk220307/sotuken/concern-app && bun run dev

# 3. ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:5173

# 4. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
# - ã‚¿ã‚¹ã‚¯ä½œæˆ
# - ã‚¿ã‚¹ã‚¯æ¨å¥¨
# - 10ç§’å¾…æ©Ÿ â†’ ç€æ‰‹ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
# - 15ç§’å¾…æ©Ÿ â†’ å®Œäº†ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
# - ã‚¹ãƒƒã‚­ãƒªåº¦é¸æŠ â†’ é€ä¿¡

# 5. ãƒ‡ãƒ¼ã‚¿ç¢ºèªï¼ˆConsoleï¼‰
const report = await db.actionReports.toArray();
console.log({
  timeToStartSec: report[0].timeToStartSec,  // æœŸå¾…: ç´„10ç§’
  clarityImprovement: report[0].clarityImprovement  // æœŸå¾…: 1-3
});
```

### ğŸ“‹ è©³ç´°ãƒ†ã‚¹ãƒˆï¼ˆ90åˆ†ï¼‰

**è©³ç´°**: `specs/testing/phase2_user_testing_plan.md`

**9ã¤ã®ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª**:
1. ã‚¿ã‚¹ã‚¯ä½œæˆæ©Ÿèƒ½
2. ã‚¿ã‚¹ã‚¯æ¨å¥¨æ©Ÿèƒ½
3. ç€æ‰‹æ¸¬å®šæ©Ÿèƒ½ â­ï¸
4. ã‚¹ãƒƒã‚­ãƒªåº¦æ¸¬å®šæ©Ÿèƒ½
5. ãƒ•ãƒ«ãƒ•ãƒ­ãƒ¼çµ±åˆãƒ†ã‚¹ãƒˆ
6. å®Ÿé¨“æ¡ä»¶å‰²ã‚Šå½“ã¦
7. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
8. ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šæ€§
9. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ğŸ”§ ã‚ˆãã‚ã‚‹å•é¡Œ

#### Q1: ã‚¿ã‚¹ã‚¯ãŒä½œæˆã§ããªã„

**ç—‡çŠ¶**: ã€Œä½œæˆã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚‚ã‚¿ã‚¹ã‚¯ãŒä½œæˆã•ã‚Œãªã„

**ç¢ºèªæ‰‹é †**:
```javascript
// 1. IndexedDBç¢ºèª
const db = new Dexie('ConcernApp');
db.version(2).stores({ tasks: 'taskId' });
await db.open();
const tasks = await db.tasks.toArray();
console.log('Tasks:', tasks);

// 2. ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ç¢ºèª
// Console ã§ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª
```

**è§£æ±ºæ–¹æ³•**:
```javascript
// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒªã‚»ãƒƒãƒˆ
indexedDB.deleteDatabase('ConcernApp');
location.reload();
```

---

#### Q2: APIæ¥ç¶šã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: "API error: 500" ã¾ãŸã¯ "Failed to fetch"

**ç¢ºèª**:
```bash
# ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ç¢ºèª
curl http://localhost:3000/health

# æœŸå¾…ãƒ¬ã‚¹ãƒãƒ³ã‚¹: {"status":"ok",...}
```

**è§£æ±º**:
```bash
# ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•
cd /home/tk220307/sotuken/server
bun run dev
```

---

#### Q3: timeToStartSec ãŒ 0

**ç—‡çŠ¶**: ActionReportã®`timeToStartSec`ãŒå¸¸ã«0

**åŸå› **: `recommendationShownAt`ãŒæœªè¨­å®š

**ç¢ºèª**:
```javascript
// TaskRecommendationScreen ã® state ç¢ºèª
console.log('recommendationShownAt:', recommendationShownAt);
// null ã®å ´åˆã¯å•é¡Œã‚ã‚Š
```

**è§£æ±º**: ã‚¿ã‚¹ã‚¯æ¨å¥¨ã‚’æœ€åˆã‹ã‚‰æ“ä½œã—ç›´ã™

---

#### Q4: ã‚¤ãƒ™ãƒ³ãƒˆãŒè¨˜éŒ²ã•ã‚Œãªã„

**ç—‡çŠ¶**: IndexedDBã®`interactionEvents`ãŒå¢—ãˆãªã„

**ç¢ºèª**:
```javascript
const events = await db.interactionEvents.count();
console.log('Event count:', events);
```

**è§£æ±º**:
1. ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰
2. Consoleã§ã‚¨ãƒ©ãƒ¼ç¢ºèª
3. EventLoggeråˆæœŸåŒ–ç¢ºèª

---

#### Q5: ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: `bun run build`ã§ã‚¨ãƒ©ãƒ¼

**æ—¢çŸ¥ã®å•é¡Œ**:
- Phase 0-1ã®æ—¢å­˜ã‚¨ãƒ©ãƒ¼ï¼ˆç´„25ä»¶ï¼‰
- æ–°è¦å®Ÿè£…ã«ã¯å½±éŸ¿ãªã—

**å¯¾å‡¦**: æ—¢å­˜ã‚¨ãƒ©ãƒ¼ã¯ç„¡è¦–ã—ã¦OK

---

### ğŸ› ãƒ‡ãƒãƒƒã‚°ã‚³ãƒãƒ³ãƒ‰

**è©³ç´°**: `specs/testing/debug_commands.md`

```javascript
// åŒ…æ‹¬çš„ãªçµ±è¨ˆãƒ¬ãƒãƒ¼ãƒˆ
async function generateTestReport() {
  const tasks = await db.tasks.count();
  const reports = await db.actionReports.count();
  const events = await db.interactionEvents.count();
  
  console.log({
    tasks,
    reports,
    events,
    avgTimeToStart: /* è¨ˆç®— */
  });
}

await generateTestReport();
```

---

## æ¬¡ã®ä½œæ¥­è€…ã¸

### ğŸ“ æœ€åˆã«èª­ã‚€ã¹ããƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

**å„ªå…ˆé †ä½**:

1. âœ… **ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆHANDOVER.mdï¼‰** - å…¨ä½“æ¦‚è¦æŠŠæ¡
2. âœ… **`specs/testing/README.md`** - ãƒ†ã‚¹ãƒˆæ–¹æ³•
3. âœ… **`specs/testing/quick_test_guide.md`** - å‹•ä½œç¢ºèªï¼ˆ15åˆ†ï¼‰
4. âœ… **`specs/project/task/phase2_detailed_tasks.md`** - å®Ÿè£…ã‚¿ã‚¹ã‚¯è©³ç´°
5. âœ… **`specs/project/phase2/overview.md`** - Phase 2è¨­è¨ˆæ›¸

### ğŸ¯ æ¨å¥¨ä½œæ¥­é †åº

#### Day 1: ç’°å¢ƒç†è§£ï¼ˆ4æ™‚é–“ï¼‰

```
1. HANDOVER.md ã‚’èª­ã‚€ï¼ˆ30åˆ†ï¼‰
   â†“
2. quick_test_guide.md ã§å‹•ä½œç¢ºèªï¼ˆ15åˆ†ï¼‰
   â†“
3. ä¸»è¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ¼ãƒ‰ãƒªãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼ˆ2æ™‚é–“ï¼‰
   - TaskRecommendationScreen.tsx
   - EventLogger.ts
   - localDB.ts
   â†“
4. ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ç¢ºèªï¼ˆ1æ™‚é–“ï¼‰
   - ã‚¿ã‚¹ã‚¯ä½œæˆâ†’æ¨å¥¨â†’ç€æ‰‹â†’å®Œäº†ã®æµã‚Œ
   - IndexedDBã®ãƒ‡ãƒ¼ã‚¿å¤‰åŒ–ã‚’ç¢ºèª
```

#### Day 2: Step 3å®Ÿè£…æº–å‚™ï¼ˆ4æ™‚é–“ï¼‰

```
1. phase2_detailed_tasks.md ã®Step 3ã‚’ç†Ÿèª­ï¼ˆ1æ™‚é–“ï¼‰
   â†“
2. Phase 1Cã®å®Ÿè£…ç¢ºèªï¼ˆ2æ™‚é–“ï¼‰
   - DynamicThoughtScreen.tsx
   - æ—¢å­˜ã®æ€è€ƒæ•´ç†ãƒ•ãƒ­ãƒ¼
   â†“
3. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ç¢ºèªï¼ˆ1æ™‚é–“ï¼‰
   - ConcernSession â†’ Task ã®å¤‰æ›
   - breakdownçµæœã®æ§‹é€ 
```

#### Day 3-7: Step 3å®Ÿè£…ï¼ˆ4-5æ—¥ï¼‰

**ã‚¿ã‚¹ã‚¯**: `phase2_detailed_tasks.md` ã®Step 3ï¼ˆ3.1-3.12ï¼‰

---

### ğŸ”‘ é‡è¦ãªã‚³ãƒ³ã‚»ãƒ—ãƒˆ

#### ç€æ‰‹ã®å®šç¾©

```
ç€æ‰‹ = ã€Œç€æ‰‹ã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸç¬é–“
```

**æ¸¬å®šå¯¾è±¡**:
- ã‚¿ã‚¹ã‚¯æ¨å¥¨è¡¨ç¤ºæ™‚åˆ»ï¼ˆ`recommendationShownAt`ï¼‰
- ç€æ‰‹ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚åˆ»ï¼ˆ`actionStartedAt`ï¼‰
- ãã®å·®åˆ†ï¼ˆ`timeToStartSec`ï¼‰

**ç ”ç©¶ã®æ ¸å¿ƒ**: ã“ã®æ™‚é–“ãŒå‹•çš„UIç‰ˆã§çŸ­ããªã‚‹ã‹ã‚’æ¤œè¨¼

---

#### ã‚¹ãƒƒã‚­ãƒªåº¦

```
ã‚¹ãƒƒã‚­ãƒªåº¦ = ã‚¿ã‚¹ã‚¯å®Œäº†å¾Œã®ä¸»è¦³çš„æº€è¶³åº¦ï¼ˆ1-3ï¼‰
```

**ä»®èª¬**: ç€æ‰‹ã—ã‚„ã™ã„UIã¯ã‚¹ãƒƒã‚­ãƒªåº¦ã‚‚é«˜ã„

---

#### å®Ÿé¨“æ¡ä»¶ã®ä¸€è²«æ€§

```
ãƒ¦ãƒ¼ã‚¶ãƒ¼ID â†’ ãƒãƒƒã‚·ãƒ¥ â†’ æ¡ä»¶ï¼ˆdynamic_ui or static_uiï¼‰
```

**é‡è¦**: åŒã˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å¸¸ã«åŒã˜æ¡ä»¶

**ç†ç”±**: ãƒ¦ãƒ¼ã‚¶ãƒ¼é–“ã®å€‹äººå·®ã‚’æ’é™¤

---

### ğŸ’¡ å®Ÿè£…Tips

#### Tip 1: IndexedDB ã‚¯ã‚¨ãƒªæœ€é©åŒ–

```typescript
// è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æ´»ç”¨
.where('[userId+status]')
.equals([userId, 'active'])
```

#### Tip 2: Date ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®æ‰±ã„

```typescript
// IndexedDBä¿å­˜æ™‚
createdAt: new Date()

// ã‚µãƒ¼ãƒãƒ¼é€ä¿¡æ™‚
createdAt: new Date().toISOString()
```

#### Tip 3: TypeScript å‹æ¨è«–

```typescript
// å‹ã‚¬ãƒ¼ãƒ‰ä½¿ç”¨
if (!task) {
  throw new Error('Task not found');
}
// ã“ã®å¾Œã¯ task ã®å‹ãŒç¢ºå®š
task.title // OK
```

#### Tip 4: React useEffect ã®ä¾å­˜é…åˆ—

```typescript
useEffect(() => {
  loadTasks();
}, [userId, activeTab]); // ä¾å­˜é–¢ä¿‚ã‚’æ˜ç¤º
```

#### Tip 5: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

```typescript
// ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
catch (error) {
  console.error('Detailed error:', error);
  alert('ã‚ã‹ã‚Šã‚„ã™ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸');
}
```

---

### ğŸ“Š å®Ÿè£…çŠ¶æ³ã‚µãƒãƒªãƒ¼

```
Phase 2 é€²æ—: 33% (Step 1-2 / Step 1-6)

âœ… å®Œäº†:
- ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ãƒ»APIçµ±åˆ
- ã‚¿ã‚¹ã‚¯æ¨å¥¨ç”»é¢
- ç€æ‰‹ç‡æ¸¬å®šæ©Ÿèƒ½
- ã‚¹ãƒƒã‚­ãƒªåº¦æ¸¬å®šæ©Ÿèƒ½
- ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ 
- å®Ÿé¨“æ¡ä»¶å‰²ã‚Šå½“ã¦

â³ æœªå®Ÿè£…:
- æ€è€ƒæ•´ç†ãƒ•ãƒ­ãƒ¼çµ±åˆ
- A/Bãƒ†ã‚¹ãƒˆæ©Ÿæ§‹
- å›ºå®šUIç‰ˆæ•´å‚™
- æ¸¬å®šãƒ»ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ ï¼ˆã‚µãƒ¼ãƒãƒ¼å´ï¼‰

ğŸ“ æ¬¡ã®ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³:
Step 3ï¼ˆ4-5æ—¥ï¼‰ â†’ Step 4ï¼ˆ3-4æ—¥ï¼‰ â†’ Step 5ï¼ˆ3-4æ—¥ï¼‰ â†’ Step 6ï¼ˆ2-3æ—¥ï¼‰
åˆè¨ˆ: 13-18æ—¥
```

---

### ğŸ“ å­¦ç¿’ãƒªã‚½ãƒ¼ã‚¹

**é–¢é€£æŠ€è¡“**:
- **Dexie.js**: https://dexie.org/
- **React Hooks**: https://react.dev/reference/react
- **Hono**: https://hono.dev/
- **TypeScript**: https://www.typescriptlang.org/

**å†…éƒ¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**:
- Phase 2è¨­è¨ˆæ›¸: `specs/project/phase2/`
- APIä»•æ§˜: `specs/project/phase2/api_specification.md`
- ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«: `specs/project/phase2/data_models.md`
- ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°: `specs/project/phase2/event_logging.md`

---

### ğŸ“ ã‚µãƒãƒ¼ãƒˆ

**å•é¡Œç™ºç”Ÿæ™‚**:

1. **ã¾ãšç¢ºèª**:
   - `specs/testing/debug_commands.md`
   - ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ã€Œãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³

2. **ãƒ‡ãƒ¼ã‚¿ä¿å­˜**:
   - IndexedDBã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
   - ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆæ’®å½±
   - Consoleãƒ­ã‚°ã‚’ä¿å­˜

3. **æƒ…å ±æ•´ç†**:
   - å†ç¾æ‰‹é †
   - ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
   - æœŸå¾…å‹•ä½œ vs å®Ÿéš›ã®å‹•ä½œ

---

### âœ… å¼•ãç¶™ããƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

#### ç’°å¢ƒç¢ºèª

- [ ] ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã§ãã‚‹ï¼ˆ`bun run dev`ï¼‰
- [ ] ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãŒèµ·å‹•ã§ãã‚‹ï¼ˆ`bun run dev`ï¼‰
- [ ] http://localhost:5173 ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹
- [ ] Chrome DevTools ã§IndexedDBãŒè¦‹ãˆã‚‹

#### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç¢ºèª

- [ ] HANDOVER.md ã‚’èª­ã‚“ã 
- [ ] quick_test_guide.md ã§ãƒ†ã‚¹ãƒˆã—ãŸ
- [ ] phase2_detailed_tasks.md ã®Step 3ã‚’èª­ã‚“ã 
- [ ] ä¸»è¦ãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€ã‚’æŠŠæ¡ã—ãŸ

#### å‹•ä½œç¢ºèª

- [ ] ã‚¿ã‚¹ã‚¯ãŒä½œæˆã§ãã‚‹
- [ ] ã‚¿ã‚¹ã‚¯æ¨å¥¨ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] timeToStartSec ãŒæ­£ç¢ºã«è¨˜éŒ²ã•ã‚Œã‚‹ï¼ˆÂ±1ç§’ï¼‰
- [ ] ã‚¹ãƒƒã‚­ãƒªåº¦ãŒè¨˜éŒ²ã•ã‚Œã‚‹
- [ ] ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ãŒè¨˜éŒ²ã•ã‚Œã‚‹

#### ç†è§£ç¢ºèª

- [ ] ç€æ‰‹ã®å®šç¾©ã‚’ç†è§£ã—ãŸ
- [ ] timeToStartSec ã®è¨ˆç®—æ–¹æ³•ã‚’ç†è§£ã—ãŸ
- [ ] IndexedDB ã‚¹ã‚­ãƒ¼ãƒã‚’ç†è§£ã—ãŸ
- [ ] ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ã®ç›®çš„ã‚’ç†è§£ã—ãŸ
- [ ] å®Ÿé¨“æ¡ä»¶ã®å‰²ã‚Šå½“ã¦æ–¹æ³•ã‚’ç†è§£ã—ãŸ

---

## ğŸ“… å®Ÿè£…å±¥æ­´

### Git ã‚³ãƒŸãƒƒãƒˆå±¥æ­´

```
9c004cd docs(phase2): Add testing documentation index
852d567 docs(phase2): Add debug commands for user testing
de388f6 docs(phase2): Add comprehensive user testing documentation
4bf8b49 feat(phase2): Implement TaskList and TaskCreate screens
7ff7c2e feat(phase2): Implement ActionReport and ClarityFeedback modals
f8c4bad feat(phase2): Implement engagement tracking (actionStart)
267cff0 feat(phase2): Implement TaskRecommendationScreen with API integration
5504256 feat(phase2): Implement /v1/config and /v1/events/batch APIs
c640de0 feat(phase2): Add server-side types and ExperimentService
3b65194 feat(phase2): Implement IndexedDB v2 schema with Task and ActionReport
821d619 feat(phase2): Add Task, ActionReport types and new EventTypes
```

### ä½œæ¥­ãƒ­ã‚°

| æ—¥ä»˜ | ä½œæ¥­å†…å®¹ | æ‰€è¦æ™‚é–“ |
|------|---------|---------|
| 2025-10-18 | Step 1: ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ãƒ»API | 3æ™‚é–“ |
| 2025-10-18 | Step 2: ã‚¿ã‚¹ã‚¯æ¨å¥¨ç”»é¢ | 4æ™‚é–“ |
| 2025-10-18 | ãƒ†ã‚¹ãƒˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ | 2æ™‚é–“ |
| 2025-10-18 | å¼•ãç¶™ãè³‡æ–™ä½œæˆ | 1æ™‚é–“ |

**åˆè¨ˆ**: ç´„10æ™‚é–“

---

## ğŸ‰ å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

Phase 2 Step 1-2ã®å®Ÿè£…ãŒå®Œäº†ã—ã¾ã—ãŸï¼

**é”æˆäº‹é …**:
- âœ… ç€æ‰‹ç‡æ¸¬å®šã®æ ¸å¿ƒæ©Ÿèƒ½å®Ÿè£…
- âœ… ã‚¹ãƒƒã‚­ãƒªåº¦æ¸¬å®šæ©Ÿèƒ½å®Ÿè£…
- âœ… ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ æ§‹ç¯‰
- âœ… åŒ…æ‹¬çš„ãªãƒ†ã‚¹ãƒˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ

**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—**:
- Step 3: æ€è€ƒæ•´ç†ãƒ•ãƒ­ãƒ¼çµ±åˆï¼ˆ4-5æ—¥ï¼‰
- `specs/project/task/phase2_detailed_tasks.md` ã®ã‚¿ã‚¹ã‚¯3.1ã‹ã‚‰é–‹å§‹

**ä½œæ¥­ã®å¼•ãç¶™ãã«å¿…è¦ãªæƒ…å ±ã¯å…¨ã¦ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚**

ã”ä¸æ˜ãªç‚¹ãŒã‚ã‚Œã°ã€ä»¥ä¸‹ã‚’å‚ç…§ã—ã¦ãã ã•ã„:
- ãƒ†ã‚¹ãƒˆæ‰‹é †: `specs/testing/`
- è¨­è¨ˆæ›¸: `specs/project/phase2/`
- å®Ÿè£…ã‚¿ã‚¹ã‚¯: `specs/project/task/phase2_detailed_tasks.md`

**Good luck with Phase 2 Step 3! ğŸš€**

---

**æ–‡æ›¸ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0  
**æœ€çµ‚æ›´æ–°**: 2025å¹´10æœˆ18æ—¥  
**ç®¡ç†å ´æ‰€**: `/home/tk220307/sotuken/HANDOVER.md`


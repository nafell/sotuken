# JellyDSL技術詳細

*Exported on: 2025/10/11 20:02:43*

ご提示いただいた論文（ソース）に基づき、Generative and Malleable User Interfaces (GMUI) のプロトタイプシステム「Jelly」の中核をなす「タスク駆動型データモデル」の構成要素、すなわち**オブジェクト指向関係スキーマ**、**依存関係グラフ**、および**UI仕様（DSL）**の仕様を詳細に解説します。

これらの構造は、大規模言語モデル (LLM) によって生成され、UIの生成と動的な進化の基盤となります。

---

## 1. オブジェクト指向関係スキーマ (Object-Relational Schema)

オブジェクト指向関係スキーマは、ユーザーの意図するタスクに関連する**本質的な情報エンティティ**、**属性**、および**エンティティ間の関係**を記述します。

このスキーマは、以下の主要な要素から構成されます。

### 1.1. Task (タスクオブジェクト)

スキーマの**ルート**となるオブジェクトです。

• **機能:** タスク全体に不可欠な属性を記述します（例：旅行計画における目的地、期間）。

• **例（週単位の食事計画）:** `start_date`、`end_date`、`daily_meal_plans`（配列属性）など。

### 1.2. Entity (エンティティ)

タスクの構成要素をモデル化します。

• **機能:** 各エンティティは属性を持ち、他のエンティティへの参照（リレーションシップ）を含むことができます。

• **例:** 食事計画における `DAILY_MEAL_PLAN`、`RECIPE`、`INGREDIENT`、`STORE` など。

### 1.3. Attribute Types (属性の型)

TaskおよびEntityオブジェクトの属性は、以下の4つの型によってレンダリング方法が決定されます。

| 型 | 名称 | 説明 | 関連するUI仕様のレンダリングタイプ |
|---|---|---|---|
| **SVAL** | Singular Data Value (単一データ値) | 日付、場所などの単一のデータ値。 | `shortText`, `number`, `time`, `location` など。 |
| **DICT** | Dictionary (辞書) | キーと値のペアを格納する辞書型（例：料理の栄養成分表）。 | DICT自体はラベル付けされず、その中の属性がレンダリングされる。 |
| **PNTR** | Pointer (ポインタ) | 別のエンティティへの参照（例：買い物アイテム内の「店舗」への参照）。 | PNTRは参照先エンティティの**サムネイル**表示を指定する。 |
| **ARRY** | Array (配列/コレクション) | SVAL型またはPNTR型のアイテムのコレクション。 | `expanded`（完全展開）または `summary`（要約表示）のいずれか。 |

**【構造上の制約】** スキーマ構文では、`DICT`の配列（Array of DICT）は許可されていません。複数のエンティティが同じ辞書構造を共有する場合、それは独立したエンティティとして抽象化され、その参照がPNTRとして扱われることで、データモデルの簡素化と一貫性が保たれます。

---

## 2. 依存関係グラフ (Dependency Graph)

依存関係グラフは、スキーマ内のエンティティや属性間の**追加的な関係や制約**を記述します。LLMはタスクの特性に基づいてこれを生成します。

依存関係の構造は以下のように定義されます。

$\text{Dependency} := {\text{Source}, \text{Target}, \text{Mechanism}, \text{Relationship}} \quad (1)$

| 要素 | 説明 |
|---|---|
| **Source** (ソース) | 依存関係の起点となる特定のエンティティまたは属性。 |
| **Target** (ターゲット) | 依存関係の影響を受ける特定のエンティティまたは属性。 |
| **Mechanism** (メカニズム) | ソースの変更に対してターゲットがどのように反応するかを定義します。以下の2種類があります。 |
|  | **Validate (検証):** 制約が守られていることを保証します（例：チェックアウト日がチェックイン日より後であること）。違反があった場合、更新は拒否され、UI上で問題がハイライトされます。 |
|  | **Update (更新):** 変更を自動的に伝播させます（例：食材の量が変更された場合、料理の総カロリーが自動更新される）。 |
| **Relationship** (関係) | ソースとターゲット間の関係を定義します。 |
|  | **コード表現:** 数値計算や検証など、コードで表現可能な場合は**JavaScriptスニペット**として生成されます。 |
|  | **自然言語表現:** コード化できない関係は、LLMが処理できるように**自然言語**で記述されます。 |

---

## 3. 生成されるUIスキーマのDSL (UI Specification)

タスク駆動型データモデル（オブジェクト指向関係スキーマと構造化データ）は、UIの構成と状態管理を導くために、**UI仕様**に変換されます。この仕様は、スキーマの各属性に特定のラベルを付与することで表現されます。

UI仕様は、タスクおよびエンティティの各属性を、**データ型、機能的役割、およびレンダリングタイプ**を指定するラベルで注釈付けします。

### 3.1. 属性注釈の主要なキーと値 (UI Specification Keys)

全ての属性は、以下の主要なキーと値で注釈付けされます。

| キー | 値/説明 |
|---|---|
| **type** | 属性のデータ型。`string`、`number`、`array`、または他のエンティティ名（例：`__USER__`）。 |
| **editable** | UI上でユーザーが値を変更できるかどうか (`true`または`false`)。 |
| **function** | 属性の機能的役割を定義。 |
|  | `privateIdentifier`: システム内部で使われる一意な識別子。UIに表示すべきではない。 |
|  | `publicIdentifier`: オブジェクトの代表的な識別情報（名前やタイトル）。UIレンダリング時に最も目立つように表示されるべき。 |
|  | `display`: 上記以外、UIに表示されるべき属性。 |

### 3.2. SVAL属性（非配列）のレンダリング仕様

`type`が`array`ではない属性の場合、`render`キーは具体的なUIウィジェットの種類を指定します。

| `render`値 | 説明 |
|---|---|
| `shortText` | 短いテキスト（例：ホテルの名前、本のタイトル）。 |
| `paragraph` | 長文ブロック（例：都市の説明、製品のレビュー）。 |
| `number` | 数値（整数、浮動小数点、パーセンテージなど）。 |
| `url` | ウェブサイトへのリンク。 |
| `time` | 日付、時間、期間などの時間的な値。 |
| `location` | 地理座標または場所の名前。 |
| `category` | 属性仕様の `categories` フィールドで定義されたカテゴリから一つを選択する。 |
| `hidden` | 属性はレンダリングされない。 |
| **例:** `start_date` は `<display, time, true>` とラベル付けされ、編集可能なカレンダーウィジェットとしてレンダリングされます。 |

### 3.3. PNTR属性の仕様

PNTR属性は、`<function, thumbnail, editable>` でラベル付けされます。

• **<function, editable>**: SVALと同じ定義です。

• **<thumbnail>**: 参照されるエンティティのうち、**最小化されたアイテムとして表示されるべき属性**を指定します（属性名の配列）。

    ◦ **例:** 買い物アイテムの `store` 属性がPNTRである場合、サムネイルとして `["name"]` が指定され、UI上では店舗名がハイパーリンクとして表示されます。

### 3.4. ARRY属性のレンダリング仕様

`type`が`array`の場合、以下のキーが追加で重要となります。

| キー | 値/説明 |
|---|---|
| **render** | コレクションの表示形式を定義。 |
|  | `expanded`: リストが完全に展開され、各アイテムが表示・スクロール可能となる。 |
|  | `summary`: リストが単一のサマリーボタンとして最小化され、指定された要約テキストと値のみが表示される。クリックで完全なリストが表示される。 |
| **item** | 配列のアイテムに関する仕様を定義。 |
|  | `type`: アイテムの型（SVALまたはエンティティ名）。 |
|  | `thumbnail`: アイテムがエンティティの場合、最小化表示で表示すべき代表的な属性名の配列（デフォルトは `publicIdentifier`）。 |
| **summary** | `render`が`summary`の場合にのみ使用されます。 |
|  | `name`: 要約の対象となる配列アイテムの属性名。 |
|  | `derived`: 要約値を導出する方法を定義するオブジェクト。`field`（対象フィールド）と `operation`（演算）の2つのキーを持ちます。`operation` は `SUM`, `AVG`, `MIN`, `MAX`, `FILTER`, `COUNT` などが可能です。 |
| **例:** `menu`（DISHの配列）が`summary`としてレンダリングされる場合、`total_calories` を `calories` フィールドの `SUM` 演算で導出することが可能です。 |

これらの詳細な仕様（DSL）が、抽象的なタスクデータモデルと具体的なReact/JavaScriptベースのUIコンポーネントとの一貫したマッピングを可能にしています。

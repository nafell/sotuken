# 研究計画書（ドラフト v1）

本計画書は、状況適応型の動的UIとプリセット優先スコアリングを用いた「頭の棚卸しノート」アプリが、日常の着手行動および認知負荷軽減（ブレインフォグ改善）に与える効果を検証するための研究計画である。実施主体は学術的研究活動であり、再現性と実験容易性を最優先に設計している。

## 1. 研究タイトル
状況適応型・動的UIが認知負荷軽減と着手行動に与える影響：「頭の棚卸しノート」にLLM駆動・CBTフローを統合した実地評価

## 2. 背景・意義
- 従来のタスク管理アプリは認知負荷が高く、頭の中に多数常駐している関心事・気掛かりによるブレインフォグ（思考の霧）を解決できない。
- 抽象的な入り口から段階的に具体化することで、procrastination（先延ばし）を防ぎ、脳のワーキングメモリを拡張する「頭の棚卸しノート」アプローチが有効である可能性がある。
- CBTフロー（実態把握→方針立案→細分化）と動的UIの組み合わせにより、着手率の向上と認知負荷軽減が期待される。

注釈（研究意図）: 背景で示した課題に対し、再現性重視の設計（設定凍結・決定論モード・リプレイ）で効果を検証する。

## 3. 目的
- 主目的: 動的UI（新規性適応）が固定UIと比較して、起動回数・着手率・認知負荷軽減（頭のスッキリ度・ブレインフォグ改善）を改善するかを検証。
- 副目的: CBTフローとプリセット重みの優先付けのみで行動促進が成立するか、HealthKit 由来の粗区分生体指標が認知負荷軽減に寄与するかを評価。

## 4. 研究仮説
- H1: 動的UIは固定UIに比し、起動回数/上位3件着手率/セッション完了率が有意に向上する。
- H2: CBTフローとプリセット重み（個人化なし）でも行動促進効果が成立する。
- H3: 生体情報（心拍/HRVの粗区分）を利用した提案は、直後の自己申告認知負荷軽減（頭のスッキリ度向上）を増加させる。

## 5. 研究デザイン
- デザイン: 4群並行比較、ユーザ単位の無作為化割付（1:1:1:1）。
- 群設定:
  - C0: 固定UI（novelty=off）
  - C1: 動的UI（novelty=Medium固定）
  - C2: 動的UI（文脈適応 Low/Med/High）
  - C3: C2 + 生体情報活用（許諾者のみ、非許諾はC2と等価）
- 期間: 最短14日（推奨28日）。
- 盲検: 介入性質上、ユーザ盲検は困難。解析時は条件非開示で行う。

注釈（研究意図）: ユーザ単位で群を固定することで交絡を減らし、期間を一定以上確保して習熟・飽き等の影響を平均化する。

## 6. 参加者
- 対象: iOSユーザ、同意取得可能な成人。ADHD傾向の自己申告者を含むが限定しない。
- 包含基準: iOS利用、同意、匿名ID発行。通知許諾は任意。
- 除外基準: 同意撤回、主要指標の70%以上欠測。
- 募集方法: オンライン募集、スノーボールサンプリング等。

## 7. インターベンション（アプリ機能）
- CBTフロー: 実態の把握（関心事の自由入力・関心度測定）→方針立案（性質分類・アプローチ選択）→細分化（2分ルール適用）。
- 優先スコアリング（プリセット）: importance, urgency, cognitiveRelief, deadlineProximity, contextFit, timeFit, staleness, energyMatch, brainFogLevel, switchCost。
- 状況認識: 時刻/カレンダー/位置カテゴリ/活動/電池/ネット/天気、任意で心拍・HRV（粗区分）。
- 動的UI: 細分化フェーズでサーバ側 LLM（Gemini 2.5 Flash mini、設定・seed固定）でJSON DSL生成。UIはホワイトリスト型コンポーネントのみ。
- 新規性制御: AttentionNeedに応じたnoveltyLevel切替、日次予算、可読性・動き上限。

注釈（研究意図）: LLMの自由度をDSLと検証で制御し、群間の差を明確化。新規性は過刺激を避ける制約付きで運用。

## 8. アウトカム（評価指標）
- 主要指標:
  - 起動回数/日
  - 起動→着手までの時間（秒）
  - 上位3件着手率（%）
  - 1セッション完了率（%）
  - 自己申告不安の低下量（0–10、before-after）
- 副次指標:
  - 通知→行動転換率、滞留日数短縮、セッション長、UI飽き指標

注釈（研究意図）: 行動の実測と主観指標の双方を記録し、包括的に効果を評価する。

## 9. 測定・データ収集
- イベント収集: ui_generated, ui_rendered, card_clicked, action_executed, task_completed, notification_shown/clicked, self_reported_mood。
- 共通メタ: eventId, userAnonId, ts, configVersion, abCondition, responseId?, contextHash?。
- 生体データ: 許諾時のみ「粗区分（low/med/high）」と時刻帯。生値は送信しない。
- データ保持: 研究用180日、運用ログ30日。

注釈（研究意図）: PIIや精密位置を保存せず、匿名IDのみで再解析可能性を確保。生体は区分化でプライバシー保護。

## 10. 介入手順
1) オンボーディングと同意取得（生体は任意）
2) 匿名ID発行、実験条件へ安定割付
3) アプリ利用（ホーム：動的/固定UI、ガイド、通知）
4) 日常利用データの収集（同意範囲内）
5) 期間満了後の自動オフボーディング

## 11. サンプルサイズ（概算）
- 効果量d=0.3、α=0.05、検出力0.8を想定した群間比較で、各群 n≈175（合計 n≈700）を目安。
- 実際の分散はパイロットで推定し、必要に応じて補正する。

## 12. 統計解析計画
- 主要指標: t検定または一般化線形モデル（共変量: 事前の起動傾向、週末/平日など）。
- 多重比較: Holm 法で補正。
- 欠測: 事前合意の単純則に加え、感度分析（多重代入/complete-case）を実施。
- 効果報告: 推定値・95%信頼区間・p値。実用的意義も検討。

## 13. 無作為化・群割付
- サーバ側で hash(userAnonId + experimentKey) により1:1:1:1に安定割付。
- abCondition はAPIレスポンスとイベントログに常時付与。

## 14. 再現性確保の運用
- 決定論モード: LLMにて temperature/topP/topK を固定し、可能なら seed を明示設定。
- コンフィグ凍結: GET /v1/config で configVersion=v1 のスナップショットを配布。
- リプレイ: responseId から当時の configSnapshot/seed/contextHash を復元し再生成・一致性検査。

注釈（研究意図）: モデル更新やプロンプト変化の影響を隔離し、同一条件の再現を保証するための仕組み。

## 15. 安全性・リスク・フォールバック
- 危険行動/医療助言の抑止: DSLホワイトリストとサーバ検証。
- 過刺激回避: 新規性の上限・日次予算。
- LLM失敗時: 直近キャッシュDSLまたは固定テンプレにフォールバック。
- センサ未許諾: 自己申告値を優先利用。
- 停止基準: 苦情率・離脱率・費用・主要指標の有意悪化が閾値超過で一時停止。

## 16. 倫理・同意
- 研究目的・データ範囲・保持期間・撤回方法を明示した同意UIを提供。
- 個人を特定できる情報は収集・保存しない。生体は区分化し、オフ可。
- 研究用途の公開データセットは再同定不可能な形式に限定。

## 17. データ管理・プライバシー
- 識別: 端末生成の匿名ID（UUID、キーチェーン保持）。
- 収集: PIIなし、位置はカテゴリ化、カレンダーは統計化。
- 通信/保存: TLS、端末はOS保護領域。保持期間後は削除。

## 18. 使用技術・実装の要点
- クライアント: iOS（SwiftUIシェル＋WKWebView）。
- サーバ: Node.js/Express。LLMはサーバサイドで呼出（Gemini 2.5 Flash mini、バージョン固定）。
- UI生成: JSON DSL v1.1、ホワイトリストコンポーネント、スキーマ検証。
- 計測: specs/api-schema/events-schema.json に準拠した匿名イベント。

## 19. スケジュール（概略）
- M1: 実装基盤・設定凍結・イベント計測
- M2: 動的UI v1、noveltyポリシー、通知
- M3: HealthKit Phase0、A/B配信、パイロット
- M4: 本番収集（14–28日）、解析、レポート

## 20. 予算・コスト管理（概略）
- LLM費用: 1日/ユーザ上限をサーバで制御。閾値超過時はキャッシュ/テンプレに切替。
- 運用: 監視（成功率/P95/費用）、異常時アラート。

## 21. 限界と留意点
- ユーザ盲検が困難、観察バイアスの可能性。
- 生体の外的要因（睡眠・疾病等）でノイズが増加。
- 実験期間が短い場合、学習/飽きの影響を十分に観測できない可能性。

## 22. 成果の公開方針
- 学会発表・論文投稿を想定。コード/設定/スキーマは可能な範囲で公開（匿名化/凍結版）。

## 付録
- A) API 仕様: api/openapi.yaml
- B) イベントスキーマ: specs/api-schema/events-schema.json
- C) UI DSL スキーマ: specs/api-schema/ui_dsl_v1.1.json
- D) 実験プロトコル詳細: specs/research/experiment_protocol.md
- E) データディクショナリ: specs/development/data_dictionary.md
- F) リプレイAPI: specs/api-schema/replay_api.md

---
本計画は、実運用と研究の両立を目的とし、再現性と安全性を確保するための設定凍結・決定論モード・リプレイ機構を備える。LLMやセンサの不確実性に対してはホワイトリストDSLとフォールバックでリスクを軽減し、倫理・プライバシー面でも最小限・匿名・統計化を徹底する。
